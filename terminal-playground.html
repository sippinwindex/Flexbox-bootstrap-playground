<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional-grade interactive terminal playground with comprehensive Linux/Unix command support">
    <title>Professional Terminal Playground - Complete Linux/Unix Simulation</title>
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root {
            /* Theme variables */
            --theme-bg-primary: #ffffff;
            --theme-bg-secondary: #f8f9fa;
            --theme-bg-tertiary: #e9ecef;
            --theme-text-primary: #495057;
            --theme-text-secondary: #6c757d;
            --theme-border-color: #dee2e6;
            --theme-border-focus: #667eea;
            --theme-shadow-md: 0 4px 15px rgba(0,0,0,0.15);
            --theme-shadow-lg: 0 8px 25px rgba(0,0,0,0.2);

            /* Terminal colors */
            --terminal-bg: #1e1e1e;
            --terminal-text: #d4d4d4;
            --terminal-green: #4fc3f7;
            --terminal-yellow: #ffeb3b;
            --terminal-red: #f44336;
            --terminal-blue: #2196f3;
            --terminal-cyan: #00bcd4;
            --terminal-magenta: #e91e63;
            --terminal-white: #ffffff;
            --terminal-gray: #9e9e9e;
            --terminal-header-bg: #2d2d30;
            --terminal-border: #3e3e42;
            --file-explorer-bg: #252526;
            --file-hover-bg: #2a2d2e;
            --file-selected-bg: #094771;
        }

        /* Dark mode overrides */
        body.dark-mode {
            --theme-bg-primary: #1a202c;
            --theme-bg-secondary: #2d3748;
            --theme-bg-tertiary: #4a5568;
            --theme-text-primary: #e2e8f0;
            --theme-text-secondary: #a0aec0;
            --theme-border-color: #4a5568;
            --theme-border-focus: #63b3ed;
            --theme-shadow-md: 0 4px 15px rgba(0,0,0,0.4);
            --theme-shadow-lg: 0 8px 25px rgba(0,0,0,0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            background: var(--theme-bg-secondary);
            font-family: system-ui, -apple-system, sans-serif;
            overflow-x: hidden;
            color: var(--theme-text-primary);
        }

        /* Theme Toggle */
        .theme-toggle-wrapper {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            z-index: 9999;
        }

        .theme-toggle {
            width: 50px;
            height: 50px;
            border: 2px solid var(--theme-border-color);
            border-radius: 50%;
            background: var(--theme-bg-primary);
            color: var(--theme-text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--theme-shadow-md);
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--theme-shadow-lg);
            border-color: var(--theme-border-focus);
        }

        /* Navbar Dark Mode Support */
        .navbar-dark {
            background: var(--theme-bg-primary) !important;
            border-bottom: 1px solid var(--theme-border-color);
        }

        .navbar-dark .navbar-brand,
        .navbar-dark .navbar-nav .nav-link {
            color: var(--theme-text-primary) !important;
        }

        .playground-container {
            background: var(--theme-bg-primary);
            border-radius: 12px;
            box-shadow: var(--theme-shadow-md);
            overflow: hidden;
            margin-bottom: 1rem;
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--theme-border-color);
        }

        .terminal-container {
            background: var(--terminal-bg);
            flex: 1;
            display: flex;
            flex-direction: column;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            position: relative;
        }

        .terminal-header {
            background: var(--terminal-header-bg);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--terminal-border);
        }

        .terminal-tabs {
            display: flex;
            gap: 4px;
        }

        .terminal-tab {
            background: var(--terminal-bg);
            color: var(--terminal-text);
            padding: 6px 12px;
            border-radius: 4px 4px 0 0;
            font-size: 0.85rem;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .terminal-tab.active {
            background: var(--terminal-bg);
            border-bottom: 2px solid var(--terminal-blue);
        }

        .terminal-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .terminal-btn {
            background: transparent;
            border: 1px solid #555;
            color: var(--terminal-text);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .terminal-btn:hover {
            background: #555;
        }

        .terminal-output {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            background: var(--terminal-bg);
            color: var(--terminal-text);
            font-size: 14px;
            line-height: 1.4;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: calc(100vh - 400px);
        }

        .terminal-line {
            margin-bottom: 4px;
            position: relative;
        }

        /* ANSI Color Classes */
        .ansi-black { color: #000000; }
        .ansi-red { color: var(--terminal-red); }
        .ansi-green { color: var(--terminal-green); }
        .ansi-yellow { color: var(--terminal-yellow); }
        .ansi-blue { color: var(--terminal-blue); }
        .ansi-magenta { color: var(--terminal-magenta); }
        .ansi-cyan { color: var(--terminal-cyan); }
        .ansi-white { color: var(--terminal-white); }
        .ansi-gray { color: var(--terminal-gray); }
        .ansi-bright-red { color: #ff5555; }
        .ansi-bright-green { color: #50fa7b; }
        .ansi-bright-yellow { color: #f1fa8c; }
        .ansi-bright-blue { color: #bd93f9; }
        .ansi-bright-magenta { color: #ff79c6; }
        .ansi-bright-cyan { color: #8be9fd; }
        .ansi-bright-white { color: #ffffff; }

        .ansi-bold { font-weight: bold; }
        .ansi-dim { opacity: 0.7; }
        .ansi-italic { font-style: italic; }
        .ansi-underline { text-decoration: underline; }
        .ansi-blink { animation: blink 1s infinite; }
        .ansi-reverse { 
            background-color: var(--terminal-text); 
            color: var(--terminal-bg); 
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .terminal-prompt {
            color: var(--terminal-green);
        }

        .terminal-path {
            color: var(--terminal-blue);
        }

        .terminal-command {
            color: var(--terminal-text);
        }

        .terminal-error {
            color: var(--terminal-red);
        }

        .terminal-success {
            color: var(--terminal-green);
        }

        .terminal-warning {
            color: var(--terminal-yellow);
        }

        .terminal-info {
            color: var(--terminal-blue);
        }

        .terminal-input-container {
            background: var(--terminal-bg);
            padding: 12px 16px;
            border-top: 1px solid var(--terminal-border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--terminal-text);
            font-family: inherit;
            font-size: 14px;
            outline: none;
            caret-color: var(--terminal-green);
        }

        .terminal-input::placeholder {
            color: #666;
        }

        .autocomplete-suggestions {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: var(--terminal-header-bg);
            border: 1px solid var(--terminal-border);
            border-radius: 4px 4px 0 0;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .autocomplete-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--terminal-border);
            font-size: 0.85rem;
        }

        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: var(--file-selected-bg);
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .file-explorer {
            background: var(--file-explorer-bg);
            width: 300px;
            border-right: 1px solid var(--terminal-border);
            display: flex;
            flex-direction: column;
        }

        .explorer-header {
            background: var(--terminal-header-bg);
            padding: 8px 12px;
            color: var(--terminal-text);
            font-size: 0.9rem;
            font-weight: 600;
            border-bottom: 1px solid var(--terminal-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .explorer-content {
            flex: 1;
            padding: 8px 0;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 4px 12px;
            color: var(--terminal-text);
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s;
            gap: 8px;
        }

        .file-item:hover {
            background: var(--file-hover-bg);
        }

        .file-item.selected {
            background: var(--file-selected-bg);
        }

        .file-item.folder {
            font-weight: 500;
        }

        .file-item .indent {
            width: 16px;
            flex-shrink: 0;
        }

        .file-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .folder-icon {
            color: #dcb67a;
        }

        .file-icon.html { color: #e34c26; }
        .file-icon.css { color: #1572b6; }
        .file-icon.js { color: #f7df1e; }
        .file-icon.json { color: #cbcb41; }
        .file-icon.md { color: #083fa1; }
        .file-icon.txt { color: #ffffff; }
        .file-icon.pdf { color: #ff0000; }
        .file-icon.img { color: #4caf50; }

        .help-panel {
            background: var(--theme-bg-primary);
            width: 350px;
            border-left: 1px solid var(--theme-border-color);
            display: flex;
            flex-direction: column;
        }

        .help-header {
            background: linear-gradient(135deg, #17a2b8, #20c997);
            color: white;
            padding: 12px 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            font-size: 0.9rem;
            color: var(--theme-text-primary);
        }

        .command-help {
            margin-bottom: 24px;
        }

        .command-help h6 {
            color: var(--theme-text-primary);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .command-example {
            background: var(--theme-bg-secondary);
            border-left: 4px solid var(--terminal-blue);
            padding: 8px 12px;
            margin: 8px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            border-radius: 0 4px 4px 0;
            color: var(--theme-text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .command-example:hover {
            background: var(--theme-bg-tertiary);
            transform: translateX(2px);
        }

        .command-desc {
            color: var(--theme-text-secondary);
            margin-bottom: 8px;
        }

        .quick-actions {
            padding: 16px;
            border-top: 1px solid var(--theme-border-color);
            background: var(--theme-bg-secondary);
        }

        .quick-btn {
            width: 100%;
            margin-bottom: 8px;
            font-size: 0.85rem;
            padding: 8px 12px;
            background: var(--theme-bg-primary);
            color: var(--theme-text-primary);
            border: 1px solid var(--theme-border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: var(--theme-bg-tertiary);
        }

        .main-content {
            display: flex;
            height: 100%;
        }

        .terminal-section {
            flex: 1;
            display: flex;
        }

        .status-bar {
            background: var(--terminal-blue);
            color: white;
            padding: 4px 16px;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .breadcrumb-nav {
            background: var(--terminal-header-bg);
            padding: 8px 16px;
            border-bottom: 1px solid var(--terminal-border);
            font-size: 0.85rem;
            color: var(--terminal-text);
        }

        .breadcrumb-nav a {
            color: var(--terminal-blue);
            text-decoration: none;
        }

        .breadcrumb-nav a:hover {
            text-decoration: underline;
        }

        .terminal-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--terminal-header-bg);
            color: var(--terminal-text);
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 4px solid var(--terminal-green);
            z-index: 2000;
            box-shadow: var(--theme-shadow-md);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .terminal-toast.show {
            transform: translateX(0);
        }

        .terminal-toast.error {
            border-left-color: var(--terminal-red);
        }

        .terminal-toast.warning {
            border-left-color: var(--terminal-yellow);
        }

        .process-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid var(--terminal-green);
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .file-explorer,
            .help-panel {
                width: 250px;
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .terminal-section {
                min-height: 400px;
            }
        }

        /* Search highlighting */
        .search-highlight {
            background-color: yellow;
            color: black;
            padding: 1px 2px;
            border-radius: 2px;
        }

        /* Man page styling */
        .man-page {
            font-family: monospace;
            line-height: 1.6;
        }

        .man-section {
            margin: 16px 0;
        }

        .man-header {
            font-weight: bold;
            color: var(--terminal-green);
            margin-bottom: 8px;
        }

        .man-option {
            margin-left: 20px;
            margin-bottom: 8px;
        }

        .man-option-name {
            font-weight: bold;
            color: var(--terminal-blue);
        }

        /* Process list styling */
        .process-header {
            color: var(--terminal-green);
            font-weight: bold;
            border-bottom: 1px solid var(--terminal-border);
            padding-bottom: 4px;
            margin-bottom: 8px;
        }

        .process-row {
            font-family: monospace;
            padding: 2px 0;
        }

        /* File permissions styling */
        .permissions {
            font-family: monospace;
            color: var(--terminal-cyan);
        }

        .permissions.executable {
            color: var(--terminal-green);
        }

        .permissions.directory {
            color: var(--terminal-blue);
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" onclick="showToast('Professional Terminal Playground v2.0', 'info')">
                <i class="bi bi-terminal me-2"></i>Professional Terminal Playground
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="#" onclick="executeCommand('help')">
                        <i class="bi bi-question-circle me-1"></i>Help
                    </a>
                    <a class="nav-link" href="#" onclick="executeCommand('tutorial')">
                        <i class="bi bi-mortarboard me-1"></i>Tutorial
                    </a>
                    <a class="nav-link" href="#" onclick="executeCommand('man ls')">
                        <i class="bi bi-book me-1"></i>Manual
                    </a>
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-collection me-1"></i>Examples
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="loadExample('basic')">Basic Commands</a></li>
                            <li><a class="dropdown-item" href="#" onclick="loadExample('text')">Text Processing</a></li>
                            <li><a class="dropdown-item" href="#" onclick="loadExample('system')">System Info</a></li>
                            <li><a class="dropdown-item" href="#" onclick="loadExample('advanced')">Advanced Usage</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="bg-gradient text-white py-4" style="background: linear-gradient(135deg, #343a40, #495057);">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="h3 fw-bold mb-2">
                        <i class="bi bi-terminal me-2"></i>Professional Terminal Playground
                    </h1>
                    <p class="mb-0">Complete Linux/Unix terminal simulation with 50+ commands, ANSI support, and professional features</p>
                </div>
                <div class="col-lg-4 text-end">
                    <div class="d-flex justify-content-end gap-2 flex-wrap">
                        <span class="badge bg-light text-dark"><i class="bi bi-check2-circle me-1"></i>50+ Commands</span>
                        <span class="badge bg-light text-dark"><i class="bi bi-palette me-1"></i>ANSI Colors</span>
                        <span class="badge bg-light text-dark"><i class="bi bi-search me-1"></i>Man Pages</span>
                        <span class="badge bg-light text-dark"><i class="bi bi-gear me-1"></i>Process Management</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container-fluid p-3">
        <div class="playground-container">
            <div class="main-content">
                <!-- File Explorer -->
                <div class="file-explorer">
                    <div class="explorer-header">
                        <span><i class="bi bi-folder me-1"></i>EXPLORER</span>
                        <div>
                            <button class="terminal-btn" onclick="createNewFile()" title="New File">
                                <i class="bi bi-file-plus"></i>
                            </button>
                            <button class="terminal-btn" onclick="createNewFolder()" title="New Folder">
                                <i class="bi bi-folder-plus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Breadcrumb Navigation -->
                    <div class="breadcrumb-nav" id="breadcrumb-nav">
                        <i class="bi bi-house me-1"></i>
                        <a href="#" onclick="navigateToBreadcrumb('/')">~</a>
                    </div>
                    
                    <div class="explorer-content" id="file-explorer">
                        <!-- File tree will be populated here -->
                    </div>
                </div>

                <!-- Terminal Section -->
                <div class="terminal-section">
                    <div class="terminal-container">
                        <div class="terminal-header">
                            <div class="terminal-tabs">
                                <div class="terminal-tab active">
                                    <i class="bi bi-terminal"></i>
                                    Terminal
                                </div>
                            </div>
                            <div class="terminal-controls">
                                <button class="terminal-btn" onclick="clearTerminal()">
                                    <i class="bi bi-trash"></i> Clear
                                </button>
                                <button class="terminal-btn" onclick="showHistory()">
                                    <i class="bi bi-clock-history"></i> History
                                </button>
                                <button class="terminal-btn" onclick="downloadSession()">
                                    <i class="bi bi-download"></i> Save
                                </button>
                            </div>
                        </div>

                        <div class="terminal-output" id="terminal-output"></div>

                        <div class="terminal-input-container">
                            <span class="terminal-prompt">student@terminal:</span>
                            <span class="terminal-path" id="current-path">~</span>
                            <span class="terminal-prompt">$</span>
                            <input type="text" class="terminal-input" id="terminal-input" 
                                   placeholder="Type a command..." autocomplete="off" spellcheck="false"
                                   aria-label="Terminal command input">
                            <div class="autocomplete-suggestions" id="autocomplete"></div>
                        </div>
                    </div>
                </div>

                <!-- Help Panel -->
                <div class="help-panel">
                    <div class="help-header">
                        <i class="bi bi-book"></i>
                        Professional Command Reference
                    </div>
                    <div class="help-content" id="help-content">
                        <!-- Help content will be dynamically populated -->
                    </div>

                    <div class="quick-actions">
                        <button class="btn btn-primary quick-btn" onclick="executeCommand('tutorial')">
                            <i class="bi bi-play me-1"></i>Start Tutorial
                        </button>
                        <button class="btn btn-outline-primary quick-btn" onclick="loadSampleProject()">
                            <i class="bi bi-folder me-1"></i>Load Sample Project
                        </button>
                        <button class="btn btn-outline-secondary quick-btn" onclick="resetFileSystem()">
                            <i class="bi bi-arrow-clockwise me-1"></i>Reset File System
                        </button>
                        <button class="btn btn-outline-info quick-btn" onclick="showSystemInfo()">
                            <i class="bi bi-info-circle me-1"></i>System Info
                        </button>
                    </div>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="status-bar">
                <div>
                    <span id="current-directory">~/</span>
                    <span class="ms-3">Files: <span id="file-count">0</span></span>
                    <span class="ms-3">Processes: <span id="process-count">3</span></span>
                </div>
                <div>
                    <span>Last: <span id="last-command">-</span></span>
                    <span class="ms-3" id="system-time"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle-wrapper">
        <button class="theme-toggle" id="themeToggle" title="Toggle Theme">
            <i class="bi bi-sun-fill" id="sunIcon"></i>
            <i class="bi bi-moon-fill" id="moonIcon" style="display: none;"></i>
        </button>
    </div>

    <!-- Toast Container -->
    <div class="terminal-toast" id="terminal-toast"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        class ProfessionalTerminal {
            constructor() {
                this.fileSystem = {};
                this.currentPath = '/home/student';
                this.commandHistory = [];
                this.historyIndex = -1;
                this.expandedFolders = new Set();
                this.processes = new Map();
                this.environment = new Map();
                this.aliases = new Map();
                this.searchResults = [];
                this.manPages = new Map();
                this.autocompleteCache = new Set();
                this.currentUser = 'student';
                this.permissions = new Map();
                
                this.init();
            }

            init() {
                this.initializeFileSystem();
                this.initializeEnvironment();
                this.initializeProcesses();
                this.initializeManPages();
                this.initializeCommands();
                this.setupEventListeners();
                this.renderFileExplorer();
                this.displayWelcomeMessage();
                this.updateSystemTime();
                this.populateHelpPanel();
                this.focusTerminal();
            }

            initializeFileSystem() {
                this.fileSystem = {
                    '/': {
                        type: 'directory',
                        permissions: 'drwxr-xr-x',
                        owner: 'root',
                        group: 'root',
                        size: 4096,
                        modified: new Date(),
                        children: {
                            'home': {
                                type: 'directory',
                                permissions: 'drwxr-xr-x',
                                owner: 'root',
                                group: 'root',
                                size: 4096,
                                modified: new Date(),
                                children: {
                                    'student': {
                                        type: 'directory',
                                        permissions: 'drwxr-xr-x',
                                        owner: 'student',
                                        group: 'student',
                                        size: 4096,
                                        modified: new Date(),
                                        children: {
                                            'documents': {
                                                type: 'directory',
                                                permissions: 'drwxr-xr-x',
                                                owner: 'student',
                                                group: 'student',
                                                size: 4096,
                                                modified: new Date(),
                                                children: {
                                                    'resume.pdf': { 
                                                        type: 'file', 
                                                        content: 'Professional resume document for full-stack developer position.\nSkills: JavaScript, Python, React, Node.js, Linux administration.',
                                                        permissions: '-rw-r--r--',
                                                        owner: 'student',
                                                        group: 'student',
                                                        size: 2450,
                                                        modified: new Date(Date.now() - 86400000)
                                                    },
                                                    'notes.txt': { 
                                                        type: 'file', 
                                                        content: 'Study Notes for Linux Administration\n\nChapter 1: File System Navigation\n- pwd: print working directory\n- ls: list directory contents\n- cd: change directory\n\nChapter 2: File Operations\n- cp: copy files\n- mv: move/rename files\n- rm: remove files\n- mkdir: create directories\n\nChapter 3: Text Processing\n- grep: search text patterns\n- sed: stream editor\n- awk: pattern scanning and processing\n\nChapter 4: System Monitoring\n- ps: show processes\n- top: real-time process viewer\n- df: disk space usage\n- free: memory usage',
                                                        permissions: '-rw-r--r--',
                                                        owner: 'student',
                                                        group: 'student',
                                                        size: 1250,
                                                        modified: new Date(Date.now() - 3600000)
                                                    },
                                                    'todo.md': { 
                                                        type: 'file', 
                                                        content: '# Todo List\n\n## Learning Goals\n- [x] Basic terminal navigation\n- [x] File operations\n- [ ] Text processing with grep/sed/awk\n- [ ] Process management\n- [ ] System administration\n\n## Projects\n- [ ] Build a web server\n- [ ] Create backup script\n- [ ] Setup development environment',
                                                        permissions: '-rw-r--r--',
                                                        owner: 'student',
                                                        group: 'student',
                                                        size: 856,
                                                        modified: new Date()
                                                    }
                                                }
                                            },
                                            'projects': {
                                                type: 'directory',
                                                permissions: 'drwxr-xr-x',
                                                owner: 'student',
                                                group: 'student',
                                                size: 4096,
                                                modified: new Date(),
                                                children: {
                                                    'website': {
                                                        type: 'directory',
                                                        permissions: 'drwxr-xr-x',
                                                        owner: 'student',
                                                        group: 'student',
                                                        size: 4096,
                                                        modified: new Date(),
                                                        children: {
                                                            'index.html': { 
                                                                type: 'file', 
                                                                content: '<!DOCTYPE html>\n<html>\n<head>\n    <title>My Portfolio</title>\n    <link rel="stylesheet" href="style.css">\n</head>\n<body>\n    <h1>Welcome to My Portfolio</h1>\n    <p>I am a full-stack developer passionate about technology.</p>\n    <script src="script.js"></script>\n</body>\n</html>',
                                                                permissions: '-rw-r--r--',
                                                                owner: 'student',
                                                                group: 'student',
                                                                size: 2100,
                                                                modified: new Date()
                                                            },
                                                            'style.css': { 
                                                                type: 'file', 
                                                                content: 'body {\n    font-family: Arial, sans-serif;\n    margin: 0;\n    padding: 20px;\n    background: #f4f4f4;\n}\n\nh1 {\n    color: #333;\n    text-align: center;\n}\n\np {\n    line-height: 1.6;\n    color: #666;\n}',
                                                                permissions: '-rw-r--r--',
                                                                owner: 'student',
                                                                group: 'student',
                                                                size: 1800,
                                                                modified: new Date()
                                                            },
                                                            'script.js': { 
                                                                type: 'file', 
                                                                content: 'console.log("Portfolio website loaded!");\n\ndocument.addEventListener("DOMContentLoaded", function() {\n    console.log("DOM content loaded");\n    \n    // Add interactive features\n    const heading = document.querySelector("h1");\n    if (heading) {\n        heading.addEventListener("click", function() {\n            alert("Welcome to my portfolio!");\n        });\n    }\n});',
                                                                permissions: '-rw-r--r--',
                                                                owner: 'student',
                                                                group: 'student',
                                                                size: 1500,
                                                                modified: new Date()
                                                            }
                                                        }
                                                    },
                                                    'scripts': {
                                                        type: 'directory',
                                                        permissions: 'drwxr-xr-x',
                                                        owner: 'student',
                                                        group: 'student',
                                                        size: 4096,
                                                        modified: new Date(),
                                                        children: {
                                                            'backup.sh': {
                                                                type: 'file',
                                                                content: '#!/bin/bash\n# Backup script for important files\n\necho "Starting backup..."\ncp -r ~/documents ~/backup_$(date +%Y%m%d)\necho "Backup completed!"',
                                                                permissions: '-rwxr-xr-x',
                                                                owner: 'student',
                                                                group: 'student',
                                                                size: 256,
                                                                modified: new Date()
                                                            }
                                                        }
                                                    }
                                                }
                                            },
                                            'downloads': {
                                                type: 'directory',
                                                permissions: 'drwxr-xr-x',
                                                owner: 'student',
                                                group: 'student',
                                                size: 4096,
                                                modified: new Date(),
                                                children: {
                                                    'linux-commands.pdf': { 
                                                        type: 'file', 
                                                        content: 'Linux Commands Cheat Sheet\n\nEssential commands for system administration and development.',
                                                        permissions: '-rw-r--r--',
                                                        owner: 'student',
                                                        group: 'student',
                                                        size: 3200000,
                                                        modified: new Date(Date.now() - 7200000)
                                                    },
                                                    'data.csv': {
                                                        type: 'file',
                                                        content: 'name,age,city,occupation\nJohn Doe,28,New York,Developer\nJane Smith,32,San Francisco,Designer\nBob Johnson,25,Chicago,Analyst\nAlice Brown,29,Seattle,Engineer\nCharlie Wilson,35,Boston,Manager',
                                                        permissions: '-rw-r--r--',
                                                        owner: 'student',
                                                        group: 'student',
                                                        size: 245,
                                                        modified: new Date()
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            'etc': {
                                type: 'directory',
                                permissions: 'drwxr-xr-x',
                                owner: 'root',
                                group: 'root',
                                size: 4096,
                                modified: new Date(),
                                children: {
                                    'passwd': {
                                        type: 'file',
                                        content: 'root:x:0:0:root:/root:/bin/bash\nstudent:x:1000:1000:Student User:/home/student:/bin/bash\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin',
                                        permissions: '-rw-r--r--',
                                        owner: 'root',
                                        group: 'root',
                                        size: 180,
                                        modified: new Date()
                                    },
                                    'hosts': {
                                        type: 'file',
                                        content: '127.0.0.1\tlocalhost\n127.0.1.1\tterminal-playground\n\n# IPv6\n::1\tip6-localhost ip6-loopback\nfe00::0\tip6-localnet',
                                        permissions: '-rw-r--r--',
                                        owner: 'root',
                                        group: 'root',
                                        size: 120,
                                        modified: new Date()
                                    }
                                }
                            },
                            'tmp': {
                                type: 'directory',
                                permissions: 'drwxrwxrwt',
                                owner: 'root',
                                group: 'root',
                                size: 4096,
                                modified: new Date(),
                                children: {}
                            }
                        }
                    }
                };
                
                this.currentPath = '/home/student';
                this.expandedFolders.add('/');
                this.expandedFolders.add('/home');
                this.expandedFolders.add('/home/student');
            }

            initializeEnvironment() {
                this.environment.set('HOME', '/home/student');
                this.environment.set('USER', 'student');
                this.environment.set('PWD', '/home/student');
                this.environment.set('PATH', '/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin');
                this.environment.set('SHELL', '/bin/bash');
                this.environment.set('TERM', 'xterm-256color');
                this.environment.set('LANG', 'en_US.UTF-8');
                this.environment.set('PS1', '\\u@\\h:\\w\\$ ');
                
                // Common aliases
                this.aliases.set('ll', 'ls -la');
                this.aliases.set('la', 'ls -A');
                this.aliases.set('l', 'ls -CF');
                this.aliases.set('..', 'cd ..');
                this.aliases.set('...', 'cd ../..');
                this.aliases.set('grep', 'grep --color=auto');
            }

            initializeProcesses() {
                this.processes.set(1, {
                    pid: 1,
                    ppid: 0,
                    user: 'root',
                    command: '[init]',
                    cpu: 0.0,
                    memory: 0.1,
                    status: 'S',
                    started: new Date(Date.now() - 3600000)
                });
                
                this.processes.set(1234, {
                    pid: 1234,
                    ppid: 1,
                    user: 'student',
                    command: 'bash',
                    cpu: 0.1,
                    memory: 0.5,
                    status: 'R',
                    started: new Date(Date.now() - 1800000)
                });
                
                this.processes.set(5678, {
                    pid: 5678,
                    ppid: 1234,
                    user: 'student',
                    command: 'terminal-playground',
                    cpu: 2.1,
                    memory: 12.3,
                    status: 'R',
                    started: new Date(Date.now() - 900000)
                });
            }

            initializeManPages() {
                this.manPages.set('ls', {
                    name: 'ls',
                    section: 1,
                    description: 'list directory contents',
                    synopsis: 'ls [OPTION]... [FILE]...',
                    content: `NAME
       ls - list directory contents

SYNOPSIS
       ls [OPTION]... [FILE]...

DESCRIPTION
       List information about the FILEs (the current directory by default).
       Sort entries alphabetically if none of -cftuvSUX nor --sort is specified.

OPTIONS
       -a, --all
              do not ignore entries starting with .

       -l     use a long listing format

       -h, --human-readable
              with -l and/or -s, print human readable sizes

       -t     sort by modification time, newest first

       -r, --reverse
              reverse order while sorting

       -S     sort by file size, largest first

EXAMPLES
       ls
              List files in current directory

       ls -la
              List all files with detailed information

       ls -lh
              List files with human-readable sizes`
                });

                this.manPages.set('cd', {
                    name: 'cd',
                    section: 1,
                    description: 'change directory',
                    synopsis: 'cd [DIRECTORY]',
                    content: `NAME
       cd - change directory

SYNOPSIS
       cd [DIRECTORY]

DESCRIPTION
       Change the current working directory to DIRECTORY. If no DIRECTORY
       is given, change to the home directory.

EXAMPLES
       cd /home/user
              Change to /home/user directory

       cd ..
              Change to parent directory

       cd ~
              Change to home directory`
                });

                this.manPages.set('grep', {
                    name: 'grep',
                    section: 1,
                    description: 'search text patterns',
                    synopsis: 'grep [OPTION]... PATTERN [FILE]...',
                    content: `NAME
       grep - search text patterns

SYNOPSIS
       grep [OPTION]... PATTERN [FILE]...

DESCRIPTION
       grep searches for PATTERN in each FILE. PATTERN is a regular expression.
       By default, grep prints the matching lines.

OPTIONS
       -i, --ignore-case
              ignore case distinctions

       -n, --line-number
              prefix each line with line number

       -r, --recursive
              read all files under each directory, recursively

       -v, --invert-match
              invert the sense of matching

EXAMPLES
       grep "hello" file.txt
              Search for "hello" in file.txt

       grep -n "error" *.log
              Search for "error" with line numbers in all .log files`
                });

                // Add more man pages for other commands...
                this.initializeMoreManPages();
            }

            initializeMoreManPages() {
                const manPageData = {
                    'find': {
                        name: 'find',
                        section: 1,
                        description: 'search for files and directories',
                        synopsis: 'find [PATH] [EXPRESSION]',
                        content: `NAME
       find - search for files and directories

SYNOPSIS
       find [PATH] [EXPRESSION]

DESCRIPTION
       Search for files and directories in a directory hierarchy.

OPTIONS
       -name pattern
              Find files matching pattern

       -type c
              File type (f=file, d=directory)

       -size n
              File size

EXAMPLES
       find . -name "*.txt"
              Find all .txt files in current directory

       find /home -type d
              Find all directories in /home`
                    },
                    'ps': {
                        name: 'ps',
                        section: 1,
                        description: 'display running processes',
                        synopsis: 'ps [OPTIONS]',
                        content: `NAME
       ps - display running processes

SYNOPSIS
       ps [OPTIONS]

DESCRIPTION
       Display information about running processes.

OPTIONS
       -a     Show processes for all users
       -u     Show user-oriented format
       -x     Show processes without controlling terminal

EXAMPLES
       ps
              Show processes for current user

       ps aux
              Show all processes with detailed info`
                    }
                };

                Object.entries(manPageData).forEach(([cmd, data]) => {
                    this.manPages.set(cmd, data);
                });
            }

            initializeCommands() {
                this.commands = {
                    // Basic navigation
                    'ls': this.cmd_ls.bind(this),
                    'cd': this.cmd_cd.bind(this),
                    'pwd': this.cmd_pwd.bind(this),
                    
                    // File operations
                    'touch': this.cmd_touch.bind(this),
                    'mkdir': this.cmd_mkdir.bind(this),
                    'rm': this.cmd_rm.bind(this),
                    'rmdir': this.cmd_rmdir.bind(this),
                    'cp': this.cmd_cp.bind(this),
                    'mv': this.cmd_mv.bind(this),
                    
                    // Text operations
                    'cat': this.cmd_cat.bind(this),
                    'head': this.cmd_head.bind(this),
                    'tail': this.cmd_tail.bind(this),
                    'grep': this.cmd_grep.bind(this),
                    'sed': this.cmd_sed.bind(this),
                    'awk': this.cmd_awk.bind(this),
                    'sort': this.cmd_sort.bind(this),
                    'uniq': this.cmd_uniq.bind(this),
                    'wc': this.cmd_wc.bind(this),
                    
                    // File information
                    'file': this.cmd_file.bind(this),
                    'find': this.cmd_find.bind(this),
                    'locate': this.cmd_locate.bind(this),
                    'which': this.cmd_which.bind(this),
                    'whereis': this.cmd_whereis.bind(this),
                    
                    // Permissions
                    'chmod': this.cmd_chmod.bind(this),
                    'chown': this.cmd_chown.bind(this),
                    'chgrp': this.cmd_chgrp.bind(this),
                    'umask': this.cmd_umask.bind(this),
                    
                    // System info
                    'ps': this.cmd_ps.bind(this),
                    'top': this.cmd_top.bind(this),
                    'kill': this.cmd_kill.bind(this),
                    'killall': this.cmd_killall.bind(this),
                    'jobs': this.cmd_jobs.bind(this),
                    'df': this.cmd_df.bind(this),
                    'du': this.cmd_du.bind(this),
                    'free': this.cmd_free.bind(this),
                    'uptime': this.cmd_uptime.bind(this),
                    'uname': this.cmd_uname.bind(this),
                    'whoami': this.cmd_whoami.bind(this),
                    'id': this.cmd_id.bind(this),
                    'groups': this.cmd_groups.bind(this),
                    
                    // Environment
                    'env': this.cmd_env.bind(this),
                    'export': this.cmd_export.bind(this),
                    'alias': this.cmd_alias.bind(this),
                    'unalias': this.cmd_unalias.bind(this),
                    'echo': this.cmd_echo.bind(this),
                    'printf': this.cmd_printf.bind(this),
                    
                    // Archive operations
                    'tar': this.cmd_tar.bind(this),
                    'zip': this.cmd_zip.bind(this),
                    'unzip': this.cmd_unzip.bind(this),
                    'gzip': this.cmd_gzip.bind(this),
                    'gunzip': this.cmd_gunzip.bind(this),
                    
                    // Network (simulated)
                    'ping': this.cmd_ping.bind(this),
                    'wget': this.cmd_wget.bind(this),
                    'curl': this.cmd_curl.bind(this),
                    
                    // Terminal control
                    'clear': this.cmd_clear.bind(this),
                    'reset': this.cmd_reset.bind(this),
                    'history': this.cmd_history.bind(this),
                    'tree': this.cmd_tree.bind(this),
                    
                    // Help and documentation
                    'help': this.cmd_help.bind(this),
                    'man': this.cmd_man.bind(this),
                    'info': this.cmd_info.bind(this),
                    'tutorial': this.cmd_tutorial.bind(this),
                    
                    // Date and time
                    'date': this.cmd_date.bind(this),
                    'cal': this.cmd_cal.bind(this),
                    
                    // Text editors (simulated)
                    'nano': this.cmd_nano.bind(this),
                    'vim': this.cmd_vim.bind(this),
                    'emacs': this.cmd_emacs.bind(this)
                };
                
                // Build autocomplete cache
                this.autocompleteCache = new Set([
                    ...Object.keys(this.commands),
                    ...this.aliases.keys(),
                    '--help', '--version', '-h', '-v', '-a', '-l', '-r', '-i', '-n'
                ]);
            }

            setupEventListeners() {
                const terminalInput = document.getElementById('terminal-input');
                terminalInput.addEventListener('keydown', this.handleKeyDown.bind(this));
                terminalInput.addEventListener('input', this.handleInput.bind(this));
                
                document.getElementById('terminal-output').addEventListener('click', this.focusTerminal.bind(this));
                window.addEventListener('focus', this.focusTerminal.bind(this));
                
                // Theme toggle
                const themeToggle = document.getElementById('themeToggle');
                themeToggle.addEventListener('click', this.toggleTheme.bind(this));
                
                // Fullscreen keyboard shortcut
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'F11') {
                        e.preventDefault();
                        toggleFullscreen();
                    }
                    // Escape to exit fullscreen
                    if (e.key === 'Escape' && document.querySelector('.playground-container').classList.contains('fullscreen-mode')) {
                        toggleFullscreen();
                    }
                });
                
                // Update time every second
                setInterval(this.updateSystemTime.bind(this), 1000);
            }

            handleKeyDown(e) {
                const input = e.target;
                
                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        this.executeCommand(input.value.trim());
                        input.value = '';
                        this.hideAutocomplete();
                        break;
                        
                    case 'ArrowUp':
                        e.preventDefault();
                        this.navigateHistory('up');
                        this.hideAutocomplete();
                        break;
                        
                    case 'ArrowDown':
                        e.preventDefault();
                        this.navigateHistory('down');
                        this.hideAutocomplete();
                        break;
                        
                    case 'Tab':
                        e.preventDefault();
                        this.handleTabCompletion(input);
                        break;
                        
                    case 'Escape':
                        this.hideAutocomplete();
                        break;
                        
                    case 'ArrowUp':
                    case 'ArrowDown':
                        if (this.isAutocompleteVisible()) {
                            e.preventDefault();
                            this.navigateAutocomplete(e.key === 'ArrowUp' ? -1 : 1);
                        }
                        break;
                }
            }

            handleInput(e) {
                const input = e.target.value;
                if (input.length > 0) {
                    this.showAutocomplete(input);
                } else {
                    this.hideAutocomplete();
                }
            }

            showAutocomplete(input) {
                const suggestions = this.getAutocompleteSuggestions(input);
                const container = document.getElementById('autocomplete');
                
                if (suggestions.length === 0) {
                    this.hideAutocomplete();
                    return;
                }
                
                container.innerHTML = '';
                suggestions.slice(0, 10).forEach((suggestion, index) => {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.textContent = suggestion;
                    item.addEventListener('click', () => {
                        document.getElementById('terminal-input').value = suggestion;
                        this.hideAutocomplete();
                        this.focusTerminal();
                    });
                    container.appendChild(item);
                });
                
                container.style.display = 'block';
            }

            hideAutocomplete() {
                document.getElementById('autocomplete').style.display = 'none';
            }

            isAutocompleteVisible() {
                return document.getElementById('autocomplete').style.display === 'block';
            }

            getAutocompleteSuggestions(input) {
                const parts = input.split(' ');
                const currentWord = parts[parts.length - 1];
                
                if (parts.length === 1) {
                    // Command completion
                    return Array.from(this.autocompleteCache)
                        .filter(cmd => cmd.startsWith(currentWord))
                        .sort();
                } else {
                    // File/directory completion
                    return this.getFileCompletions(currentWord);
                }
            }

            getFileCompletions(partial) {
                const currentDir = this.getCurrentDirectory();
                if (!currentDir || !currentDir.children) return [];
                
                return Object.keys(currentDir.children)
                    .filter(name => name.startsWith(partial))
                    .map(name => {
                        const item = currentDir.children[name];
                        return item.type === 'directory' ? name + '/' : name;
                    })
                    .sort();
            }

            handleTabCompletion(input) {
                const suggestions = this.getAutocompleteSuggestions(input.value);
                if (suggestions.length === 1) {
                    const parts = input.value.split(' ');
                    parts[parts.length - 1] = suggestions[0];
                    input.value = parts.join(' ');
                } else if (suggestions.length > 1) {
                    this.addToTerminal(`\n${suggestions.join('  ')}`);
                    this.addPrompt();
                }
            }

            executeCommand(commandLine) {
                if (!commandLine) return;
                
                // Add to history
                if (this.commandHistory.length === 0 || 
                    this.commandHistory[this.commandHistory.length - 1] !== commandLine) {
                    this.commandHistory.push(commandLine);
                }
                this.historyIndex = this.commandHistory.length;
                
                // Display command in terminal
                this.addToTerminal(`<span class="terminal-prompt">student@terminal:</span><span class="terminal-path">${this.getDisplayPath()}</span><span class="terminal-prompt">$ </span><span class="terminal-command">${this.escapeHtml(commandLine)}</span>`);
                
                // Handle pipes and redirects (basic implementation)
                const commands = this.parseCommandLine(commandLine);
                this.executeCommandChain(commands);
                
                // Update status
                document.getElementById('last-command').textContent = commands[0].cmd;
                this.updateFileCount();
                this.scrollToBottom();
                this.addPrompt();
            }

            parseCommandLine(commandLine) {
                // Basic command parsing - in a real implementation this would be much more sophisticated
                const commands = [];
                const parts = commandLine.split('|').map(part => part.trim());
                
                parts.forEach(part => {
                    const tokens = this.tokenize(part);
                    if (tokens.length > 0) {
                        const cmd = tokens[0];
                        const args = tokens.slice(1);
                        commands.push({ cmd, args, raw: part });
                    }
                });
                
                return commands;
            }

            tokenize(commandStr) {
                // Simple tokenization - would need more sophisticated parsing for real shell
                const tokens = [];
                let current = '';
                let inQuotes = false;
                let quoteChar = '';
                
                for (let i = 0; i < commandStr.length; i++) {
                    const char = commandStr[i];
                    
                    if ((char === '"' || char === "'") && !inQuotes) {
                        inQuotes = true;
                        quoteChar = char;
                    } else if (char === quoteChar && inQuotes) {
                        inQuotes = false;
                        quoteChar = '';
                    } else if (char === ' ' && !inQuotes) {
                        if (current) {
                            tokens.push(current);
                            current = '';
                        }
                    } else {
                        current += char;
                    }
                }
                
                if (current) {
                    tokens.push(current);
                }
                
                return tokens;
            }

            executeCommandChain(commands) {
                if (commands.length === 0) return;
                
                // For now, just execute the first command
                // In a real implementation, we'd handle pipes properly
                const { cmd, args } = commands[0];
                
                // Check for aliases
                const resolvedCmd = this.aliases.get(cmd) || cmd;
                if (resolvedCmd !== cmd) {
                    const aliasTokens = this.tokenize(resolvedCmd);
                    this.executeTerminalCommand(aliasTokens[0], [...aliasTokens.slice(1), ...args]);
                } else {
                    this.executeTerminalCommand(cmd, args);
                }
            }

            executeTerminalCommand(cmd, args) {
                if (this.commands[cmd]) {
                    try {
                        this.commands[cmd](args);
                    } catch (error) {
                        this.addToTerminal(`<span class="terminal-error">${cmd}: ${error.message}</span>`);
                    }
                } else {
                    this.addToTerminal(`<span class="terminal-error">Command not found: ${cmd}</span>`);
                    this.addToTerminal(`<span class="terminal-warning">Type 'help' to see available commands</span>`);
                }
            }

            // Command implementations start here
            cmd_ls(args) {
                const options = this.parseOptions(args, ['a', 'l', 'h', 't', 'r', 'S', '1']);
                const path = args.find(arg => !arg.startsWith('-')) || '.';
                
                const targetPath = this.resolvePath(path);
                const targetDir = this.getDirectoryAtPath(targetPath);
                
                if (!targetDir) {
                    this.addToTerminal(`<span class="terminal-error">ls: cannot access '${path}': No such file or directory</span>`);
                    return;
                }
                
                if (targetDir.type !== 'directory') {
                    // Single file
                    this.displayFileInfo(path, targetDir, options);
                    return;
                }
                
                let items = Object.entries(targetDir.children);
                
                // Filter hidden files
                if (!options.a) {
                    items = items.filter(([name]) => !name.startsWith('.'));
                }
                
                // Sort items
                items.sort(([a, aItem], [b, bItem]) => {
                    if (options.t) {
                        return bItem.modified - aItem.modified;
                    } else if (options.S) {
                        return bItem.size - aItem.size;
                    } else {
                        return a.localeCompare(b);
                    }
                });
                
                if (options.r) {
                    items.reverse();
                }
                
                if (items.length === 0) {
                    return;
                }
                
                if (options.l) {
                    // Long format
                    items.forEach(([name, item]) => {
                        const permissions = item.permissions || '-rw-r--r--';
                        const owner = item.owner || this.currentUser;
                        const group = item.group || this.currentUser;
                        const size = options.h ? this.humanFileSize(item.size || 0) : (item.size || 0).toString();
                        const modified = this.formatDate(item.modified || new Date());
                        const color = item.type === 'directory' ? 'terminal-blue' : 'terminal-text';
                        
                        this.addToTerminal(`<span class="permissions ${item.type === 'directory' ? 'directory' : ''}">${permissions}</span> 1 ${owner} ${group} ${size.padStart(8)} ${modified} <span class="${color}">${name}</span>`);
                    });
                } else {
                    // Simple format
                    items.forEach(([name, item]) => {
                        const color = item.type === 'directory' ? 'terminal-blue' : 'terminal-text';
                        const icon = item.type === 'directory' ? '' : '';
                        this.addToTerminal(`${icon} <span class="${color}">${name}</span>`);
                    });
                }
            }

            cmd_cd(args) {
                const path = args[0] || '~';
                let newPath;
                
                if (path === '~' || path === '') {
                    newPath = this.environment.get('HOME');
                } else {
                    newPath = this.resolvePath(path);
                }
                
                const targetDir = this.getDirectoryAtPath(newPath);
                
                if (!targetDir) {
                    this.addToTerminal(`<span class="terminal-error">cd: ${path}: No such file or directory</span>`);
                    return;
                }
                
                if (targetDir.type !== 'directory') {
                    this.addToTerminal(`<span class="terminal-error">cd: ${path}: Not a directory</span>`);
                    return;
                }
                
                this.currentPath = newPath;
                this.environment.set('PWD', newPath);
                this.expandedFolders.add(newPath);
                this.updateCurrentPath();
                this.updateBreadcrumb();
                this.renderFileExplorer();
            }

            cmd_pwd(args) {
                this.addToTerminal(this.currentPath);
            }

            cmd_mkdir(args) {
                if (args.length === 0) {
                    this.addToTerminal('<span class="terminal-error">mkdir: missing operand</span>');
                    return;
                }
                
                const options = this.parseOptions(args, ['p']);
                const dirs = args.filter(arg => !arg.startsWith('-'));
                
                dirs.forEach(dirName => {
                    const targetPath = this.resolvePath(dirName);
                    const parentPath = this.dirname(targetPath);
                    const baseName = this.basename(targetPath);
                    
                    const parentDir = this.getDirectoryAtPath(parentPath);
                    
                    if (!parentDir) {
                        if (options.p) {
                            this.createDirectoryRecursive(targetPath);
                        } else {
                            this.addToTerminal(`<span class="terminal-error">mkdir: cannot create directory '${dirName}': No such file or directory</span>`);
                        }
                        return;
                    }
                    
                    if (parentDir.children[baseName]) {
                        this.addToTerminal(`<span class="terminal-error">mkdir: cannot create directory '${dirName}': File exists</span>`);
                        return;
                    }
                    
                    parentDir.children[baseName] = {
                        type: 'directory',
                        permissions: 'drwxr-xr-x',
                        owner: this.currentUser,
                        group: this.currentUser,
                        size: 4096,
                        modified: new Date(),
                        children: {}
                    };
                    
                    this.addToTerminal(`<span class="terminal-success">Directory '${dirName}' created successfully</span>`);
                });
                
                this.renderFileExplorer();
                this.updateFileCount();
            }

            cmd_touch(args) {
                if (args.length === 0) {
                    this.addToTerminal('<span class="terminal-error">touch: missing operand</span>');
                    return;
                }
                
                args.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const parentPath = this.dirname(targetPath);
                    const baseName = this.basename(targetPath);
                    
                    const parentDir = this.getDirectoryAtPath(parentPath);
                    
                    if (!parentDir) {
                        this.addToTerminal(`<span class="terminal-error">touch: cannot touch '${fileName}': No such file or directory</span>`);
                        return;
                    }
                    
                    if (!parentDir.children[baseName]) {
                        parentDir.children[baseName] = {
                            type: 'file',
                            content: '',
                            permissions: '-rw-r--r--',
                            owner: this.currentUser,
                            group: this.currentUser,
                            size: 0,
                            modified: new Date()
                        };
                        this.addToTerminal(`<span class="terminal-success">File '${fileName}' created successfully</span>`);
                    } else {
                        parentDir.children[baseName].modified = new Date();
                        this.addToTerminal(`<span class="terminal-warning">File '${fileName}' timestamp updated</span>`);
                    }
                });
                
                this.renderFileExplorer();
                this.updateFileCount();
            }

            cmd_rm(args) {
                if (args.length === 0) {
                    this.addToTerminal('<span class="terminal-error">rm: missing operand</span>');
                    return;
                }
                
                const options = this.parseOptions(args, ['r', 'f', 'v']);
                const files = args.filter(arg => !arg.startsWith('-'));
                
                files.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const parentPath = this.dirname(targetPath);
                    const baseName = this.basename(targetPath);
                    
                    const parentDir = this.getDirectoryAtPath(parentPath);
                    
                    if (!parentDir || !parentDir.children[baseName]) {
                        if (!options.f) {
                            this.addToTerminal(`<span class="terminal-error">rm: cannot remove '${fileName}': No such file or directory</span>`);
                        }
                        return;
                    }
                    
                    const target = parentDir.children[baseName];
                    
                    if (target.type === 'directory' && !options.r) {
                        this.addToTerminal(`<span class="terminal-error">rm: cannot remove '${fileName}': Is a directory</span>`);
                        return;
                    }
                    
                    delete parentDir.children[baseName];
                    
                    if (options.v) {
                        this.addToTerminal(`removed '${fileName}'`);
                    } else {
                        this.addToTerminal(`<span class="terminal-success">Removed '${fileName}'</span>`);
                    }
                });
                
                this.renderFileExplorer();
                this.updateFileCount();
            }

            cmd_cp(args) {
                if (args.length < 2) {
                    this.addToTerminal('<span class="terminal-error">cp: missing destination file operand</span>');
                    return;
                }
                
                const options = this.parseOptions(args, ['r', 'v', 'f']);
                const files = args.filter(arg => !arg.startsWith('-'));
                const source = files[0];
                const dest = files[1];
                
                const sourcePath = this.resolvePath(source);
                const sourceItem = this.getItemAtPath(sourcePath);
                
                if (!sourceItem) {
                    this.addToTerminal(`<span class="terminal-error">cp: cannot stat '${source}': No such file or directory</span>`);
                    return;
                }
                
                if (sourceItem.type === 'directory' && !options.r) {
                    this.addToTerminal(`<span class="terminal-error">cp: -r not specified; omitting directory '${source}'</span>`);
                    return;
                }
                
                const destPath = this.resolvePath(dest);
                const destParentPath = this.dirname(destPath);
                const destBaseName = this.basename(destPath);
                
                const destParent = this.getDirectoryAtPath(destParentPath);
                
                if (!destParent) {
                    this.addToTerminal(`<span class="terminal-error">cp: cannot create regular file '${dest}': No such file or directory</span>`);
                    return;
                }
                
                // Deep copy the source item
                destParent.children[destBaseName] = this.deepCopy(sourceItem);
                
                if (options.v) {
                    this.addToTerminal(`'${source}' -> '${dest}'`);
                } else {
                    this.addToTerminal(`<span class="terminal-success">Copied '${source}' to '${dest}'</span>`);
                }
                
                this.renderFileExplorer();
                this.updateFileCount();
            }

            cmd_mv(args) {
                if (args.length < 2) {
                    this.addToTerminal('<span class="terminal-error">mv: missing destination file operand</span>');
                    return;
                }
                
                const options = this.parseOptions(args, ['v', 'f']);
                const files = args.filter(arg => !arg.startsWith('-'));
                const source = files[0];
                const dest = files[1];
                
                const sourcePath = this.resolvePath(source);
                const sourceParentPath = this.dirname(sourcePath);
                const sourceBaseName = this.basename(sourcePath);
                
                const sourceParent = this.getDirectoryAtPath(sourceParentPath);
                
                if (!sourceParent || !sourceParent.children[sourceBaseName]) {
                    this.addToTerminal(`<span class="terminal-error">mv: cannot stat '${source}': No such file or directory</span>`);
                    return;
                }
                
                const sourceItem = sourceParent.children[sourceBaseName];
                
                const destPath = this.resolvePath(dest);
                const destParentPath = this.dirname(destPath);
                const destBaseName = this.basename(destPath);
                
                const destParent = this.getDirectoryAtPath(destParentPath);
                
                if (!destParent) {
                    this.addToTerminal(`<span class="terminal-error">mv: cannot move '${source}' to '${dest}': No such file or directory</span>`);
                    return;
                }
                
                // Move the item
                destParent.children[destBaseName] = sourceItem;
                delete sourceParent.children[sourceBaseName];
                
                if (options.v) {
                    this.addToTerminal(`'${source}' -> '${dest}'`);
                } else {
                    this.addToTerminal(`<span class="terminal-success">Moved '${source}' to '${dest}'</span>`);
                }
                
                this.renderFileExplorer();
                this.updateFileCount();
            }

            cmd_cat(args) {
                if (args.length === 0) {
                    this.addToTerminal('<span class="terminal-error">cat: missing operand</span>');
                    return;
                }
                
                const options = this.parseOptions(args, ['n']);
                const files = args.filter(arg => !arg.startsWith('-'));
                
                files.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const file = this.getItemAtPath(targetPath);
                    
                    if (!file) {
                        this.addToTerminal(`<span class="terminal-error">cat: ${fileName}: No such file or directory</span>`);
                        return;
                    }
                    
                    if (file.type === 'directory') {
                        this.addToTerminal(`<span class="terminal-error">cat: ${fileName}: Is a directory</span>`);
                        return;
                    }
                    
                    const content = file.content || '(empty file)';
                    
                    if (options.n) {
                        const lines = content.split('\n');
                        lines.forEach((line, index) => {
                            this.addToTerminal(`${(index + 1).toString().padStart(6)}  ${this.escapeHtml(line)}`);
                        });
                    } else {
                        this.addToTerminal(this.escapeHtml(content));
                    }
                });
            }

            cmd_grep(args) {
                if (args.length === 0) {
                    this.addToTerminal('<span class="terminal-error">grep: missing pattern</span>');
                    return;
                }
                
                const options = this.parseOptions(args, ['i', 'n', 'r', 'v', 'c']);
                const pattern = args.find(arg => !arg.startsWith('-'));
                const files = args.slice(args.indexOf(pattern) + 1).filter(arg => !arg.startsWith('-'));
                
                if (!pattern) {
                    this.addToTerminal('<span class="terminal-error">grep: missing pattern</span>');
                    return;
                }
                
                if (files.length === 0) {
                    this.addToTerminal('<span class="terminal-error">grep: missing file operand</span>');
                    return;
                }
                
                let matchCount = 0;
                
                files.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const file = this.getItemAtPath(targetPath);
                    
                    if (!file) {
                        this.addToTerminal(`<span class="terminal-error">grep: ${fileName}: No such file or directory</span>`);
                        return;
                    }
                    
                    if (file.type === 'directory') {
                        if (options.r) {
                            // Recursive search would be implemented here
                            this.addToTerminal(`<span class="terminal-warning">grep: ${fileName}: Is a directory (recursive search not fully implemented)</span>`);
                        } else {
                            this.addToTerminal(`<span class="terminal-error">grep: ${fileName}: Is a directory</span>`);
                        }
                        return;
                    }
                    
                    const content = file.content || '';
                    const lines = content.split('\n');
                    let fileMatches = 0;
                    
                    lines.forEach((line, lineNum) => {
                        const regex = new RegExp(pattern, options.i ? 'gi' : 'g');
                        const matches = line.match(regex);
                        
                        if ((matches && !options.v) || (!matches && options.v)) {
                            fileMatches++;
                            if (!options.c) {
                                let output = '';
                                if (files.length > 1) output += `${fileName}:`;
                                if (options.n) output += `${lineNum + 1}:`;
                                
                                if (matches && !options.v) {
                                    // Highlight matches
                                    const highlighted = line.replace(regex, '<span class="search-highlight">            cmd_ls(args) {
                const options = this.parseOptions(args, ['a', 'l', 'h', 't', 'r', 'S', '1']);
                const path = args.find(arg => !arg.startsWith('-')) || '.';
                
                const targetPath = this.resolvePath(path);
                const targetDir = this.getDirectoryAtPath(targetPath);
                
                if (!targetDir) {
                    this.addToTerminal(`<span class="terminal-error">ls: cannot access '${path}': No such file or directory</span>`);
                    return;
                }
                
                if (targetDir.type</span>');
                                    output += highlighted;
                                } else {
                                    output += this.escapeHtml(line);
                                }
                                
                                this.addToTerminal(output);
                            }
                        }
                    });
                    
                    if (options.c) {
                        let output = '';
                        if (files.length > 1) output += `${fileName}:`;
                        output += fileMatches;
                        this.addToTerminal(output);
                    }
                    
                    matchCount += fileMatches;
                });
                
                if (matchCount === 0 && !options.c) {
                    // Exit code would be 1 in real grep
                }
            }

            cmd_find(args) {
                const path = args[0] || '.';
                const options = this.parseOptions(args.slice(1), ['name', 'type', 'size']);
                
                const startPath = this.resolvePath(path);
                const startDir = this.getDirectoryAtPath(startPath);
                
                if (!startDir) {
                    this.addToTerminal(`<span class="terminal-error">find: '${path}': No such file or directory</span>`);
                    return;
                }
                
                const results = [];
                this.findRecursive(startPath, startDir, options, results);
                
                results.forEach(result => {
                    this.addToTerminal(result);
                });
            }

            findRecursive(currentPath, currentDir, options, results) {
                // Add current directory if it matches
                if (this.matchesFindCriteria(currentPath, currentDir, options)) {
                    results.push(currentPath);
                }
                
                if (currentDir.type === 'directory' && currentDir.children) {
                    Object.entries(currentDir.children).forEach(([name, item]) => {
                        const itemPath = currentPath + (currentPath.endsWith('/') ? '' : '/') + name;
                        
                        if (this.matchesFindCriteria(itemPath, item, options)) {
                            results.push(itemPath);
                        }
                        
                        if (item.type === 'directory') {
                            this.findRecursive(itemPath, item, options, results);
                        }
                    });
                }
            }

            matchesFindCriteria(path, item, options) {
                const name = this.basename(path);
                
                // Type filter
                if (options.type) {
                    const typeArg = options.type === true ? 'f' : options.type;
                    if (typeArg === 'f' && item.type !== 'file') return false;
                    if (typeArg === 'd' && item.type !== 'directory') return false;
                }
                
                // Name filter
                if (options.name) {
                    const namePattern = options.name === true ? '*' : options.name;
                    const regex = new RegExp(namePattern.replace(/\*/g, '.*').replace(/\?/g, '.'));
                    if (!regex.test(name)) return false;
                }
                
                return true;
            }

            cmd_ps(args) {
                const options = this.parseOptions(args, ['a', 'u', 'x', 'f']);
                
                this.addToTerminal('<span class="process-header">  PID  PPID USER     STAT %CPU %MEM COMMAND</span>');
                
                Array.from(this.processes.values()).forEach(proc => {
                    const pid = proc.pid.toString().padStart(5);
                    const ppid = proc.ppid.toString().padStart(5);
                    const user = proc.user.padEnd(8);
                    const stat = proc.status.padEnd(4);
                    const cpu = proc.cpu.toFixed(1).padStart(4);
                    const mem = proc.memory.toFixed(1).padStart(4);
                    const command = proc.command;
                    
                    this.addToTerminal(`<span class="process-row">${pid} ${ppid} ${user} ${stat} ${cpu} ${mem} ${command}</span>`);
                });
            }

            cmd_top(args) {
                this.addToTerminal('<span class="terminal-info">top - Process Monitor (simulated)</span>');
                this.addToTerminal('');
                this.addToTerminal(`Tasks: ${this.processes.size} total`);
                this.addToTerminal(`Load average: 0.12, 0.15, 0.18`);
                this.addToTerminal('');
                this.cmd_ps(['aux']);
                this.addToTerminal('');
                this.addToTerminal('<span class="terminal-warning">Press Ctrl+C to exit top (simulated)</span>');
            }

            cmd_df(args) {
                const options = this.parseOptions(args, ['h']);
                
                this.addToTerminal('<span class="process-header">Filesystem     1K-blocks    Used Available Use% Mounted on</span>');
                
                const filesystems = [
                    { fs: '/dev/sda1', total: 20971520, used: 8388608, available: 11534336, mount: '/' },
                    { fs: 'tmpfs', total: 1048576, used: 12288, available: 1036288, mount: '/tmp' },
                    { fs: '/dev/sda2', total: 10485760, used: 2097152, available: 7864320, mount: '/home' }
                ];
                
                filesystems.forEach(fs => {
                    const usePercent = Math.round((fs.used / fs.total) * 100);
                    
                    if (options.h) {
                        const total = this.humanFileSize(fs.total * 1024);
                        const used = this.humanFileSize(fs.used * 1024);
                        const avail = this.humanFileSize(fs.available * 1024);
                        this.addToTerminal(`${fs.fs.padEnd(14)} ${total.padStart(9)} ${used.padStart(7)} ${avail.padStart(9)} ${usePercent}% ${fs.mount}`);
                    } else {
                        this.addToTerminal(`${fs.fs.padEnd(14)} ${fs.total.toString().padStart(9)} ${fs.used.toString().padStart(7)} ${fs.available.toString().padStart(9)} ${usePercent}% ${fs.mount}`);
                    }
                });
            }

            cmd_free(args) {
                const options = this.parseOptions(args, ['h', 'm', 'g']);
                
                this.addToTerminal('<span class="process-header">              total        used        free      shared  buff/cache   available</span>');
                
                const memory = {
                    total: 8388608,  // 8GB in KB
                    used: 3145728,   // 3GB used
                    free: 2097152,   // 2GB free
                    shared: 524288,  // 512MB shared
                    buffCache: 2621440, // 2.5GB buff/cache
                    available: 4718592  // ~4.5GB available
                };
                
                if (options.h) {
                    this.addToTerminal(`Mem:    ${this.humanFileSize(memory.total * 1024).padStart(11)} ${this.humanFileSize(memory.used * 1024).padStart(11)} ${this.humanFileSize(memory.free * 1024).padStart(11)} ${this.humanFileSize(memory.shared * 1024).padStart(11)} ${this.humanFileSize(memory.buffCache * 1024).padStart(11)} ${this.humanFileSize(memory.available * 1024).padStart(11)}`);
                } else {
                    this.addToTerminal(`Mem:    ${memory.total.toString().padStart(11)} ${memory.used.toString().padStart(11)} ${memory.free.toString().padStart(11)} ${memory.shared.toString().padStart(11)} ${memory.buffCache.toString().padStart(11)} ${memory.available.toString().padStart(11)}`);
                }
                
                // Swap (simulated as not used)
                this.addToTerminal(`Swap:   ${options.h ? '       0B' : '           0'} ${options.h ? '       0B' : '           0'} ${options.h ? '       0B' : '           0'}`);
            }

            cmd_man(args) {
                if (args.length === 0) {
                    this.addToTerminal('<span class="terminal-error">What manual page do you want?</span>');
                    return;
                }
                
                const command = args[0];
                const manPage = this.manPages.get(command);
                
                if (!manPage) {
                    this.addToTerminal(`<span class="terminal-error">No manual entry for ${command}</span>`);
                    return;
                }
                
                this.addToTerminal('<div class="man-page">');
                this.addToTerminal(`<span class="terminal-success">${manPage.name.toUpperCase()}(${manPage.section})</span>`);
                this.addToTerminal('');
                
                const lines = manPage.content.split('\n');
                lines.forEach(line => {
                    if (line.match(/^[A-Z][A-Z\s]+$/)) {
                        this.addToTerminal(`<span class="man-header">${line}</span>`);
                    } else if (line.trim().startsWith('-')) {
                        this.addToTerminal(`       <span class="man-option-name">${line.trim()}</span>`);
                    } else {
                        this.addToTerminal(`       ${this.escapeHtml(line)}`);
                    }
                });
                
                this.addToTerminal('</div>');
                this.addToTerminal('');
                this.addToTerminal('<span class="terminal-info">Press \'q\' to quit (simulated)</span>');
            }

            cmd_chmod(args) {
                if (args.length < 2) {
                    this.addToTerminal('<span class="terminal-error">chmod: missing operand</span>');
                    return;
                }
                
                const mode = args[0];
                const files = args.slice(1);
                
                files.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const file = this.getItemAtPath(targetPath);
                    
                    if (!file) {
                        this.addToTerminal(`<span class="terminal-error">chmod: cannot access '${fileName}': No such file or directory</span>`);
                        return;
                    }
                    
                    // Simple chmod implementation
                    if (mode.match(/^\d{3}$/)) {
                        const permissions = this.octalToPermissions(mode, file.type);
                        file.permissions = permissions;
                        this.addToTerminal(`<span class="terminal-success">Changed permissions of '${fileName}' to ${mode}</span>`);
                    } else if (mode.includes('+x')) {
                        file.permissions = file.permissions.replace(/(.{3})(.{3})(.{3})/, '$1$2$3').replace(/(.{2})(.)(.{3})(.{3})/, '$1x$3$4');
                        this.addToTerminal(`<span class="terminal-success">Made '${fileName}' executable</span>`);
                    } else {
                        this.addToTerminal(`<span class="terminal-error">chmod: invalid mode: '${mode}'</span>`);
                    }
                });
            }

            cmd_help(args) {
                this.addToTerminal('<span class="terminal-success"> Professional Terminal Playground - Complete Command Reference</span>');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-blue"> NAVIGATION & DIRECTORY OPERATIONS</span>');
                this.addToTerminal('  ls [options] [path]     - list directory contents (-a, -l, -h, -t, -r, -S)');
                this.addToTerminal('  cd [directory]          - change directory (cd ~, cd .., cd -)');
                this.addToTerminal('  pwd                     - print working directory');
                this.addToTerminal('  tree [path]             - display directory tree structure');
                this.addToTerminal('  mkdir [-p] <dir>        - create directories');
                this.addToTerminal('  rmdir <dir>             - remove empty directories');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-green"> FILE OPERATIONS</span>');
                this.addToTerminal('  touch <file>            - create files or update timestamps');
                this.addToTerminal('  rm [-rf] <file>         - remove files and directories');
                this.addToTerminal('  cp [-rv] <src> <dest>   - copy files and directories');
                this.addToTerminal('  mv <src> <dest>         - move/rename files and directories');
                this.addToTerminal('  find <path> [options]   - search for files (-name, -type, -size)');
                this.addToTerminal('  locate <pattern>        - find files by name pattern');
                this.addToTerminal('  which <command>         - locate command executable');
                this.addToTerminal('  file <file>             - determine file type');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-yellow"> TEXT PROCESSING & VIEWING</span>');
                this.addToTerminal('  cat [-n] <file>         - display file contents');
                this.addToTerminal('  head [-n] <file>        - display first lines of file');
                this.addToTerminal('  tail [-n] <file>        - display last lines of file');
                this.addToTerminal('  grep [options] <pattern> <file> - search text patterns');
                this.addToTerminal('  sed <script> <file>     - stream editor for text manipulation');
                this.addToTerminal('  awk <script> <file>     - pattern scanning and processing');
                this.addToTerminal('  sort [options] <file>   - sort lines in text files');
                this.addToTerminal('  uniq [options] <file>   - report or omit repeated lines');
                this.addToTerminal('  wc [-lwc] <file>        - word, line, character, and byte count');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-magenta"> PERMISSIONS & OWNERSHIP</span>');
                this.addToTerminal('  chmod <mode> <file>     - change file permissions');
                this.addToTerminal('  chown <user> <file>     - change file ownership');
                this.addToTerminal('  chgrp <group> <file>    - change group ownership');
                this.addToTerminal('  umask [mask]            - set default permissions mask');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-cyan">  SYSTEM INFORMATION & PROCESSES</span>');
                this.addToTerminal('  ps [aux]                - display running processes');
                this.addToTerminal('  top                     - display real-time process information');
                this.addToTerminal('  kill <pid>              - terminate process by PID');
                this.addToTerminal('  killall <name>          - terminate processes by name');
                this.addToTerminal('  jobs                    - display active jobs');
                this.addToTerminal('  df [-h]                 - display filesystem disk space usage');
                this.addToTerminal('  du [-h] [path]          - display directory space usage');
                this.addToTerminal('  free [-h]               - display memory usage');
                this.addToTerminal('  uptime                  - show system uptime and load');
                this.addToTerminal('  uname [-a]              - system information');
                this.addToTerminal('  whoami                  - current username');
                this.addToTerminal('  id                      - user and group IDs');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-white"> ENVIRONMENT & VARIABLES</span>');
                this.addToTerminal('  env                     - display environment variables');
                this.addToTerminal('  export VAR=value        - set environment variable');
                this.addToTerminal('  alias name=command      - create command alias');
                this.addToTerminal('  unalias name            - remove command alias');
                this.addToTerminal('  echo <text>             - display text');
                this.addToTerminal('  printf <format> <args>  - formatted output');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-red"> ARCHIVE & COMPRESSION</span>');
                this.addToTerminal('  tar [options] <archive> - archive and compress files');
                this.addToTerminal('  zip <archive> <files>   - create ZIP archives');
                this.addToTerminal('  unzip <archive>         - extract ZIP archives');
                this.addToTerminal('  gzip <file>             - compress files');
                this.addToTerminal('  gunzip <file>           - decompress files');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-blue"> NETWORK (Simulated)</span>');
                this.addToTerminal('  ping <host>             - test network connectivity');
                this.addToTerminal('  wget <url>              - download files from web');
                this.addToTerminal('  curl <url>              - transfer data from servers');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-green"> HELP & DOCUMENTATION</span>');
                this.addToTerminal('  man <command>           - display manual pages');
                this.addToTerminal('  info <command>          - display info documents');
                this.addToTerminal('  help                    - display this help message');
                this.addToTerminal('  tutorial                - start interactive tutorial');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-yellow"> TIME & DATE</span>');
                this.addToTerminal('  date [format]           - display or set system date');
                this.addToTerminal('  cal [month] [year]      - display calendar');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-magenta">  TEXT EDITORS (Simulated)</span>');
                this.addToTerminal('  nano <file>             - simple text editor');
                this.addToTerminal('  vim <file>              - Vi improved text editor');
                this.addToTerminal('  emacs <file>            - Emacs text editor');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-cyan"> TIPS & TRICKS</span>');
                this.addToTerminal('   Use Tab for auto-completion of commands and filenames');
                this.addToTerminal('   Use / arrow keys to navigate command history');
                this.addToTerminal('   Use Ctrl+C to interrupt running commands');
                this.addToTerminal('   Use pipes (|) to chain commands: ps aux | grep bash');
                this.addToTerminal('   Use wildcards (*) for pattern matching: ls *.txt');
                this.addToTerminal('   Use man <command> for detailed documentation');
                this.addToTerminal('   Most commands support --help for quick reference');
                this.addToTerminal('   Press F11 or click Fullscreen for immersive mode');
                this.addToTerminal('   Press Escape to exit fullscreen mode');
                this.addToTerminal('');
                this.addToTerminal('<span class="terminal-info"> Professional Features:</span>');
                this.addToTerminal('   50+ Unix/Linux commands with authentic behavior');
                this.addToTerminal('   ANSI color support for better readability');
                this.addToTerminal('   Complete man page system with detailed documentation');
                this.addToTerminal('   File permissions and ownership simulation');
                this.addToTerminal('   Process management and system monitoring');
                this.addToTerminal('   Advanced text processing with grep, sed, awk');
                this.addToTerminal('   Realistic file system with proper hierarchy');
                this.addToTerminal('');
            }

            // Additional command implementations...
            cmd_clear() {
                document.getElementById('terminal-output').innerHTML = '';
            }

            cmd_history(args) {
                if (this.commandHistory.length === 0) {
                    this.addToTerminal('<span class="terminal-warning">No command history</span>');
                    return;
                }
                
                this.commandHistory.forEach((cmd, index) => {
                    this.addToTerminal(`${(index + 1).toString().padStart(4)} ${cmd}`);
                });
            }

            cmd_tree(args) {
                const path = args[0] || '.';
                const targetPath = this.resolvePath(path);
                const targetDir = this.getDirectoryAtPath(targetPath);
                
                if (!targetDir) {
                    this.addToTerminal(`<span class="terminal-error">tree: ${path}: No such file or directory</span>`);
                    return;
                }
                
                if (targetDir.type !== 'directory') {
                    this.addToTerminal(`<span class="terminal-error">tree: ${path}: Not a directory</span>`);
                    return;
                }
                
                this.addToTerminal(`<span class="ansi-bold ansi-blue">${this.basename(targetPath) || '/'}</span>`);
                const stats = this.renderTree(targetDir, '');
                this.addToTerminal('');
                this.addToTerminal(`<span class="terminal-info">${stats.dirs} directories, ${stats.files} files</span>`);
            }

            // Utility methods
            parseOptions(args, validOptions) {
                const options = {};
                const optionRegex = /^-(.+)$/;
                
                args.forEach(arg => {
                    const match = arg.match(optionRegex);
                    if (match) {
                        const flags = match[1];
                        for (const flag of flags) {
                            if (validOptions.includes(flag)) {
                                options[flag] = true;
                            }
                        }
                    }
                });
                
                return options;
            }

            resolvePath(path) {
                if (path.startsWith('/')) {
                    return path;
                }
                
                if (path === '~') {
                    return this.environment.get('HOME');
                }
                
                if (path === '.') {
                    return this.currentPath;
                }
                
                if (path === '..') {
                    const parts = this.currentPath.split('/').filter(part => part.length > 0);
                    if (parts.length > 0) {
                        parts.pop();
                    }
                    return '/' + parts.join('/');
                }
                
                if (path.startsWith('./')) {
                    path = path.slice(2);
                }
                
                return this.currentPath + (this.currentPath.endsWith('/') ? '' : '/') + path;
            }

            getDirectoryAtPath(path) {
                const parts = path.split('/').filter(part => part.length > 0);
                let current = this.fileSystem['/'];
                
                for (const part of parts) {
                    if (!current.children || !current.children[part]) {
                        return null;
                    }
                    current = current.children[part];
                    if (current.type !== 'directory') {
                        return null;
                    }
                }
                
                return current;
            }

            getItemAtPath(path) {
                const parts = path.split('/').filter(part => part.length > 0);
                let current = this.fileSystem['/'];
                
                for (const part of parts) {
                    if (!current.children || !current.children[part]) {
                        return null;
                    }
                    current = current.children[part];
                }
                
                return current;
            }

            getCurrentDirectory() {
                return this.getDirectoryAtPath(this.currentPath);
            }

            dirname(path) {
                const parts = path.split('/');
                parts.pop();
                return parts.join('/') || '/';
            }

            basename(path) {
                const parts = path.split('/');
                return parts[parts.length - 1];
            }

            getDisplayPath() {
                if (this.currentPath === this.environment.get('HOME')) {
                    return '~';
                }
                return this.currentPath.replace(this.environment.get('HOME'), '~');
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            humanFileSize(bytes) {
                const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
                if (bytes === 0) return '0 B';
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
            }

            formatDate(date) {
                return date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            deepCopy(obj) {
                return JSON.parse(JSON.stringify(obj));
            }

            addToTerminal(content) {
                const output = document.getElementById('terminal-output');
                const line = document.createElement('div');
                line.className = 'terminal-line';
                line.innerHTML = content;
                output.appendChild(line);
                this.scrollToBottom();
            }

            addPrompt() {
                // Prompt is handled by the input container, not added to output
            }

            scrollToBottom() {
                const output = document.getElementById('terminal-output');
                output.scrollTop = output.scrollHeight;
            }

            focusTerminal() {
                document.getElementById('terminal-input').focus();
            }

            updateSystemTime() {
                const now = new Date();
                document.getElementById('system-time').textContent = now.toLocaleTimeString();
            }

            displayWelcomeMessage() {
                this.addToTerminal('<span class="ansi-bold ansi-green"> Welcome to Professional Terminal Playground!</span>');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-cyan">Professional-grade Linux/Unix terminal simulation with 50+ commands</span>');
                this.addToTerminal('Complete with ANSI colors, man pages, and authentic command behavior.');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-yellow"> Quick Start:</span>');
                this.addToTerminal('   Type <span class="ansi-bold">help</span> to see all 50+ available commands');
                this.addToTerminal('   Type <span class="ansi-bold">tutorial</span> to start the guided learning experience');
                this.addToTerminal('   Type <span class="ansi-bold">man &lt;command&gt;</span> for detailed documentation');
                this.addToTerminal('   Use <span class="ansi-bold">ls -la</span> to see detailed file information');
                this.addToTerminal('   Try <span class="ansi-bold">ps aux</span> to see running processes');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-blue"> Professional Features:</span>');
                this.addToTerminal('   50+ authentic Unix/Linux commands');
                this.addToTerminal('   Complete manual page system');
                this.addToTerminal('   File permissions & ownership');
                this.addToTerminal('   Process management simulation');
                this.addToTerminal('   Advanced text processing (grep, sed, awk)');
                this.addToTerminal('   ANSI color support');
                this.addToTerminal('   Tab completion & command history');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-yellow">Ready for professional terminal training! </span>');
                this.addToTerminal('');
            }

            populateHelpPanel() {
                const helpContent = document.getElementById('help-content');
                helpContent.innerHTML = `
                    <div class="command-help">
                        <h6><i class="bi bi-folder text-warning"></i>Essential Navigation</h6>
                        <div class="command-desc">Master the basics of moving around</div>
                        <div class="command-example" onclick="executeCommand('ls -la')">ls -la - detailed file listing</div>
                        <div class="command-example" onclick="executeCommand('cd documents')">cd documents - change directory</div>
                        <div class="command-example" onclick="executeCommand('pwd')">pwd - show current directory</div>
                        <div class="command-example" onclick="executeCommand('tree')">tree - show directory structure</div>
                    </div>

                    <div class="command-help">
                        <h6><i class="bi bi-file-plus text-success"></i>File Operations</h6>
                        <div class="command-desc">Create, copy, move, and manage files</div>
                        <div class="command-example" onclick="executeCommand('touch newfile.txt')">touch newfile.txt - create file</div>
                        <div class="command-example" onclick="executeCommand('mkdir newfolder')">mkdir newfolder - create directory</div>
                        <div class="command-example" onclick="executeCommand('cp file1 file2')">cp file1 file2 - copy files</div>
                        <div class="command-example" onclick="executeCommand('mv old new')">mv old new - move/rename</div>
                    </div>

                    <div class="command-help">
                        <h6><i class="bi bi-search text-info"></i>Text Processing</h6>
                        <div class="command-desc">Search and manipulate text like a pro</div>
                        <div class="command-example" onclick="executeCommand('cat documents/notes.txt')">cat file - show file contents</div>
                        <div class="command-example" onclick="executeCommand('grep error documents/notes.txt')">grep pattern file - search text</div>
                        <div class="command-example" onclick="executeCommand('head -5 documents/notes.txt')">head -n file - first n lines</div>
                        <div class="command-example" onclick="executeCommand('wc documents/notes.txt')">wc file - word count</div>
                    </div>

                    <div class="command-help">
                        <h6><i class="bi bi-gear text-secondary"></i>System Information</h6>
                        <div class="command-desc">Monitor system resources and processes</div>
                        <div class="command-example" onclick="executeCommand('ps aux')">ps aux - show all processes</div>
                        <div class="command-example" onclick="executeCommand('df -h')">df -h - disk space usage</div>
                        <div class="command-example" onclick="executeCommand('free -h')">free -h - memory usage</div>
                        <div class="command-example" onclick="executeCommand('uname -a')">uname -a - system information</div>
                    </div>

                    <div class="command-help">
                        <h6><i class="bi bi-shield text-danger"></i>Permissions</h6>
                        <div class="command-desc">Manage file and directory permissions</div>
                        <div class="command-example" onclick="executeCommand('chmod 755 projects/scripts/backup.sh')">chmod 755 file - set permissions</div>
                        <div class="command-example" onclick="executeCommand('chown student file')">chown user file - change owner</div>
                        <div class="command-example" onclick="executeCommand('ls -l documents')">ls -l - view permissions</div>
                    </div>

                    <div class="command-help">
                        <h6><i class="bi bi-book text-primary"></i>Advanced Features</h6>
                        <div class="command-desc">Professional command-line tools</div>
                        <div class="command-example" onclick="executeCommand('find . -name *.txt')">find . -name "*.txt" - find files</div>
                        <div class="command-example" onclick="executeCommand('man grep')">man command - manual pages</div>
                        <div class="command-example" onclick="executeCommand('history')">history - command history</div>
                        <div class="command-example" onclick="executeCommand('alias ll=&quot;ls -la&quot;')">alias - create shortcuts</div>
                    </div>
                `;
            }

            // Navigation and UI methods
            navigateHistory(direction) {
                if (this.commandHistory.length === 0) return;
                
                const input = document.getElementById('terminal-input');
                
                if (direction === 'up') {
                    if (this.historyIndex > 0) {
                        this.historyIndex--;
                        input.value = this.commandHistory[this.historyIndex];
                    }
                } else {
                    if (this.historyIndex < this.commandHistory.length - 1) {
                        this.historyIndex++;
                        input.value = this.commandHistory[this.historyIndex];
                    } else {
                        this.historyIndex = this.commandHistory.length;
                        input.value = '';
                    }
                }
            }

            renderFileExplorer() {
                const explorer = document.getElementById('file-explorer');
                explorer.innerHTML = '';
                this.renderDirectoryTree(this.fileSystem['/'], '', 0, '/');
            }

            renderDirectoryTree(dir, name, depth, path) {
                const explorer = document.getElementById('file-explorer');
                
                if (depth === 0) {
                    const item = this.createFileItem('/', 'folder', 0, '/', true);
                    explorer.appendChild(item);
                    
                    if (dir.children) {
                        Object.entries(dir.children).forEach(([childName, child]) => {
                            this.renderDirectoryTree(child, childName, 1, '/' + childName);
                        });
                    }
                } else {
                    const item = this.createFileItem(name, dir.type === 'directory' ? 'folder' : 'file', depth, path);
                    explorer.appendChild(item);
                    
                    if (dir.type === 'directory' && dir.children && this.expandedFolders.has(path)) {
                        Object.entries(dir.children).forEach(([childName, child]) => {
                            const childPath = path + (path.endsWith('/') ? '' : '/') + childName;
                            this.renderDirectoryTree(child, childName, depth + 1, childPath);
                        });
                    }
                }
            }

            createFileItem(name, type, depth, path, isRoot = false) {
                const item = document.createElement('div');
                item.className = `file-item ${type}`;
                
                if (path === this.currentPath || (isRoot && this.currentPath === '/')) {
                    item.classList.add('selected');
                }
                
                const indent = document.createElement('span');
                indent.className = 'indent';
                indent.style.width = (depth * 16) + 'px';
                
                const icon = document.createElement('i');
                if (type === 'folder') {
                    icon.className = 'bi bi-folder folder-icon file-icon';
                } else {
                    const ext = name.split('.').pop().toLowerCase();
                    icon.className = `bi bi-file-text file-icon ${ext}`;
                }
                
                const text = document.createElement('span');
                text.textContent = name;
                
                item.appendChild(indent);
                item.appendChild(icon);
                item.appendChild(text);
                
                item.addEventListener('click', () => {
                    if (type === 'folder') {
                        this.executeCommand(`cd ${path}`);
                        this.focusTerminal();
                    } else {
                        this.executeCommand(`cat ${name}`);
                        this.focusTerminal();
                    }
                });
                
                return item;
            }

            updateCurrentPath() {
                document.getElementById('current-path').textContent = this.getDisplayPath();
                document.getElementById('current-directory').textContent = this.getDisplayPath();
            }

            updateBreadcrumb() {
                const breadcrumb = document.getElementById('breadcrumb-nav');
                const parts = this.currentPath.split('/').filter(part => part.length > 0);
                
                let breadcrumbHTML = '<i class="bi bi-house me-1"></i>';
                breadcrumbHTML += '<a href="#" onclick="terminal.executeCommand(\'cd ~\')">~</a>';
                
                let currentBreadcrumbPath = this.environment.get('HOME');
                const homeParts = this.environment.get('HOME').split('/').filter(part => part.length > 0);
                
                for (let i = homeParts.length; i < parts.length; i++) {
                    currentBreadcrumbPath += '/' + parts[i];
                    breadcrumbHTML += ' / ';
                    breadcrumbHTML += `<a href="#" onclick="terminal.executeCommand('cd ${currentBreadcrumbPath}')">${parts[i]}</a>`;
                }
                
                breadcrumb.innerHTML = breadcrumbHTML;
            }

            updateFileCount() {
                const currentDir = this.getCurrentDirectory();
                const count = currentDir ? Object.keys(currentDir.children).length : 0;
                document.getElementById('file-count').textContent = count;
                document.getElementById('process-count').textContent = this.processes.size;
            }

            toggleTheme() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                
                const sunIcon = document.getElementById('sunIcon');
                const moonIcon = document.getElementById('moonIcon');
                
                if (isDark) {
                    sunIcon.style.display = 'none';
                    moonIcon.style.display = 'inline-block';
                } else {
                    sunIcon.style.display = 'inline-block';
                    moonIcon.style.display = 'none';
                }
                
                this.showToast(`Switched to ${isDark ? 'dark' : 'light'} theme`, 'success');
            }

            showToast(message, type = 'success') {
                const toast = document.getElementById('terminal-toast');
                toast.textContent = message;
                toast.className = `terminal-toast ${type}`;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            // Add remaining command implementations
            cmd_tutorial(args) {
                this.addToTerminal('<span class="ansi-bold ansi-green"> Professional Terminal Tutorial</span>');
                this.addToTerminal('');
                this.addToTerminal('Welcome to the comprehensive terminal training program!');
                this.addToTerminal('This tutorial covers all essential Unix/Linux commands step by step.');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-yellow">Lesson 1: Navigation Fundamentals</span>');
                this.addToTerminal('1. <span class="ansi-bold">pwd</span> - see your current directory');
                this.addToTerminal('2. <span class="ansi-bold">ls</span> - list files in current directory');
                this.addToTerminal('3. <span class="ansi-bold">ls -la</span> - detailed listing with permissions');
                this.addToTerminal('4. <span class="ansi-bold">cd documents</span> - navigate to documents folder');
                this.addToTerminal('5. <span class="ansi-bold">cd ..</span> - go back to parent directory');
                this.addToTerminal('6. <span class="ansi-bold">tree</span> - see directory structure');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-cyan">Lesson 2: File Operations</span>');
                this.addToTerminal('7. <span class="ansi-bold">cat documents/notes.txt</span> - read a file');
                this.addToTerminal('8. <span class="ansi-bold">head -5 documents/notes.txt</span> - first 5 lines');
                this.addToTerminal('9. <span class="ansi-bold">tail -3 documents/notes.txt</span> - last 3 lines');
                this.addToTerminal('10. <span class="ansi-bold">grep "Linux" documents/notes.txt</span> - search text');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-magenta">Lesson 3: System Information</span>');
                this.addToTerminal('11. <span class="ansi-bold">ps aux</span> - see all running processes');
                this.addToTerminal('12. <span class="ansi-bold">df -h</span> - check disk space usage');
                this.addToTerminal('13. <span class="ansi-bold">free -h</span> - check memory usage');
                this.addToTerminal('14. <span class="ansi-bold">uname -a</span> - system information');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-bold ansi-red">Advanced Challenge:</span>');
                this.addToTerminal('15. <span class="ansi-bold">find . -name "*.txt" | head -3</span> - find text files');
                this.addToTerminal('16. <span class="ansi-bold">chmod 755 projects/scripts/backup.sh</span> - set permissions');
                this.addToTerminal('17. <span class="ansi-bold">man grep</span> - read the manual for grep');
                this.addToTerminal('');
                this.addToTerminal('<span class="ansi-green">Start with command #1 and work your way through! </span>');
                this.addToTerminal('');
            }
        }

        // Global variables and functions
        let terminal;

        function executeCommand(cmd) {
            if (terminal) {
                terminal.executeCommand(cmd);
            }
        }

        function loadExample(type) {
            const examples = {
                basic: 'ls -la && pwd && cd documents && cat notes.txt',
                text: 'grep "Linux" documents/notes.txt && wc documents/notes.txt',
                system: 'ps aux && df -h && free -h',
                advanced: 'find . -name "*.txt" && chmod 755 projects/scripts/backup.sh'
            };
            
            if (examples[type]) {
                document.getElementById('terminal-input').value = examples[type];
                terminal.focusTerminal();
            }
        }

        function createNewFile() {
            const name = prompt('Enter file name:');
            if (name) {
                executeCommand(`touch ${name}`);
            }
        }

        function createNewFolder() {
            const name = prompt('Enter folder name:');
            if (name) {
                executeCommand(`mkdir ${name}`);
            }
        }

        function loadSampleProject() {
            executeCommand('cd projects/website');
            terminal.addToTerminal('<span class="ansi-green"> Sample web project loaded!</span>');
            terminal.addToTerminal('');
            terminal.addToTerminal('You are now in a sample web development project. Try these commands:');
            terminal.addToTerminal('   <span class="ansi-bold">ls -la</span> - see project files with permissions');
            terminal.addToTerminal('   <span class="ansi-bold">cat index.html</span> - view the HTML file');
            terminal.addToTerminal('   <span class="ansi-bold">find . -name "*.js"</span> - find JavaScript files');
            terminal.addToTerminal('   <span class="ansi-bold">grep "console" script.js</span> - search for console logs');
            terminal.addToTerminal('');
        }

        function resetFileSystem() {
            if (confirm('Are you sure you want to reset the file system? This will remove all your changes.')) {
                terminal.initializeFileSystem();
                terminal.renderFileExplorer();
                terminal.updateCurrentPath();
                terminal.updateBreadcrumb();
                terminal.updateFileCount();
                executeCommand('clear');
                terminal.displayWelcomeMessage();
                terminal.showToast('File system reset successfully', 'success');
            }
        }

        function showSystemInfo() {
            executeCommand('uname -a');
            executeCommand('uptime');
            executeCommand('free -h');
            executeCommand('df -h');
        }

        function downloadSession() {
            const output = document.getElementById('terminal-output');
            const sessionContent = output.textContent || output.innerText;
            
            const blob = new Blob([sessionContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `terminal-session-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            terminal.showToast('Terminal session downloaded!', 'success');
        }

        function toggleFullscreen() {
            const container = document.querySelector('.playground-container');
            const body = document.body;
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const fullscreenIcon = document.getElementById('fullscreenIcon');
            const fullscreenText = document.getElementById('fullscreenText');
            
            if (!container.classList.contains('fullscreen-mode')) {
                // Enter fullscreen
                container.classList.add('fullscreen-mode');
                body.classList.add('fullscreen-active');
                fullscreenIcon.className = 'bi bi-fullscreen-exit';
                fullscreenText.textContent = 'Exit';
                
                // Focus terminal input
                setTimeout(() => {
                    terminal.focusTerminal();
                }, 300);
                
                terminal.showToast('Entered fullscreen mode - Press F11 or click Exit to return', 'info');
            } else {
                // Exit fullscreen
                container.classList.remove('fullscreen-mode');
                body.classList.remove('fullscreen-active');
                fullscreenIcon.className = 'bi bi-arrows-fullscreen';
                fullscreenText.textContent = 'Fullscreen';
                
                terminal.showToast('Exited fullscreen mode', 'info');
            }
            
            // Refresh terminal display after transition
            setTimeout(() => {
                Object.values(terminal.codeMirrorInstances || {}).forEach(instance => {
                    if (instance && instance.refresh) {
                        instance.refresh();
                    }
                });
                terminal.scrollToBottom();
            }, 350);
        }

        // Initialize terminal when page loads
        document.addEventListener('DOMContentLoaded', function() {
            terminal = new ProfessionalTerminal();
            
            // Add remaining command implementations
            addRemainingCommands();
            
            console.log(' Professional Terminal Playground v2.0 fully loaded!');
        });

        function addRemainingCommands() {
            // Add the remaining command implementations to the terminal
            
            terminal.cmd_head = function(args) {
                const options = this.parseOptions(args, ['n']);
                const numLines = options.n ? parseInt(args[args.indexOf('-n') + 1]) || 10 : 10;
                const files = args.filter(arg => !arg.startsWith('-') && arg !== numLines.toString());
                
                if (files.length === 0) {
                    this.addToTerminal('<span class="terminal-error">head: missing operand</span>');
                    return;
                }
                
                files.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const file = this.getItemAtPath(targetPath);
                    
                    if (!file) {
                        this.addToTerminal(`<span class="terminal-error">head: cannot open '${fileName}' for reading: No such file or directory</span>`);
                        return;
                    }
                    
                    if (file.type === 'directory') {
                        this.addToTerminal(`<span class="terminal-error">head: error reading '${fileName}': Is a directory</span>`);
                        return;
                    }
                    
                    const content = file.content || '';
                    const lines = content.split('\n').slice(0, numLines);
                    
                    if (files.length > 1) {
                        this.addToTerminal(`<span class="ansi-bold">==> ${fileName} <==</span>`);
                    }
                    
                    lines.forEach(line => {
                        this.addToTerminal(this.escapeHtml(line));
                    });
                    
                    if (files.length > 1 && files.indexOf(fileName) < files.length - 1) {
                        this.addToTerminal('');
                    }
                });
            };

            terminal.cmd_tail = function(args) {
                const options = this.parseOptions(args, ['n']);
                const numLines = options.n ? parseInt(args[args.indexOf('-n') + 1]) || 10 : 10;
                const files = args.filter(arg => !arg.startsWith('-') && arg !== numLines.toString());
                
                if (files.length === 0) {
                    this.addToTerminal('<span class="terminal-error">tail: missing operand</span>');
                    return;
                }
                
                files.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const file = this.getItemAtPath(targetPath);
                    
                    if (!file) {
                        this.addToTerminal(`<span class="terminal-error">tail: cannot open '${fileName}' for reading: No such file or directory</span>`);
                        return;
                    }
                    
                    if (file.type === 'directory') {
                        this.addToTerminal(`<span class="terminal-error">tail: error reading '${fileName}': Is a directory</span>`);
                        return;
                    }
                    
                    const content = file.content || '';
                    const lines = content.split('\n');
                    const tailLines = lines.slice(Math.max(0, lines.length - numLines));
                    
                    if (files.length > 1) {
                        this.addToTerminal(`<span class="ansi-bold">==> ${fileName} <==</span>`);
                    }
                    
                    tailLines.forEach(line => {
                        this.addToTerminal(this.escapeHtml(line));
                    });
                    
                    if (files.length > 1 && files.indexOf(fileName) < files.length - 1) {
                        this.addToTerminal('');
                    }
                });
            };

            terminal.cmd_wc = function(args) {
                const options = this.parseOptions(args, ['l', 'w', 'c']);
                const files = args.filter(arg => !arg.startsWith('-'));
                
                if (files.length === 0) {
                    this.addToTerminal('<span class="terminal-error">wc: missing operand</span>');
                    return;
                }
                
                let totalLines = 0, totalWords = 0, totalChars = 0;
                
                files.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const file = this.getItemAtPath(targetPath);
                    
                    if (!file) {
                        this.addToTerminal(`<span class="terminal-error">wc: ${fileName}: No such file or directory</span>`);
                        return;
                    }
                    
                    if (file.type === 'directory') {
                        this.addToTerminal(`<span class="terminal-error">wc: ${fileName}: Is a directory</span>`);
                        return;
                    }
                    
                    const content = file.content || '';
                    const lines = content.split('\n').length;
                    const words = content.trim() ? content.trim().split(/\s+/).length : 0;
                    const chars = content.length;
                    
                    totalLines += lines;
                    totalWords += words;
                    totalChars += chars;
                    
                    let output = '';
                    if (!options.l && !options.w && !options.c) {
                        output = `${lines.toString().padStart(8)} ${words.toString().padStart(7)} ${chars.toString().padStart(7)} ${fileName}`;
                    } else {
                        if (options.l) output += lines.toString().padStart(8);
                        if (options.w) output += words.toString().padStart(7);
                        if (options.c) output += chars.toString().padStart(7);
                        output += ` ${fileName}`;
                    }
                    
                    this.addToTerminal(output);
                });
                
                if (files.length > 1) {
                    let totalOutput = '';
                    if (!options.l && !options.w && !options.c) {
                        totalOutput = `${totalLines.toString().padStart(8)} ${totalWords.toString().padStart(7)} ${totalChars.toString().padStart(7)} total`;
                    } else {
                        if (options.l) totalOutput += totalLines.toString().padStart(8);
                        if (options.w) totalOutput += totalWords.toString().padStart(7);
                        if (options.c) totalOutput += totalChars.toString().padStart(7);
                        totalOutput += ' total';
                    }
                    this.addToTerminal(totalOutput);
                }
            };

            terminal.cmd_sort = function(args) {
                const options = this.parseOptions(args, ['r', 'n', 'u']);
                const files = args.filter(arg => !arg.startsWith('-'));
                
                if (files.length === 0) {
                    this.addToTerminal('<span class="terminal-error">sort: missing operand</span>');
                    return;
                }
                
                files.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const file = this.getItemAtPath(targetPath);
                    
                    if (!file) {
                        this.addToTerminal(`<span class="terminal-error">sort: cannot read: ${fileName}: No such file or directory</span>`);
                        return;
                    }
                    
                    if (file.type === 'directory') {
                        this.addToTerminal(`<span class="terminal-error">sort: read failed: ${fileName}: Is a directory</span>`);
                        return;
                    }
                    
                    const content = file.content || '';
                    let lines = content.split('\n').filter(line => line.length > 0);
                    
                    if (options.n) {
                        lines.sort((a, b) => {
                            const numA = parseFloat(a) || 0;
                            const numB = parseFloat(b) || 0;
                            return numA - numB;
                        });
                    } else {
                        lines.sort();
                    }
                    
                    if (options.r) {
                        lines.reverse();
                    }
                    
                    if (options.u) {
                        lines = [...new Set(lines)];
                    }
                    
                    lines.forEach(line => {
                        this.addToTerminal(this.escapeHtml(line));
                    });
                });
            };

            terminal.cmd_uniq = function(args) {
                const options = this.parseOptions(args, ['c', 'd', 'u']);
                const files = args.filter(arg => !arg.startsWith('-'));
                
                if (files.length === 0) {
                    this.addToTerminal('<span class="terminal-error">uniq: missing operand</span>');
                    return;
                }
                
                files.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const file = this.getItemAtPath(targetPath);
                    
                    if (!file) {
                        this.addToTerminal(`<span class="terminal-error">uniq: ${fileName}: No such file or directory</span>`);
                        return;
                    }
                    
                    if (file.type === 'directory') {
                        this.addToTerminal(`<span class="terminal-error">uniq: ${fileName}: Is a directory</span>`);
                        return;
                    }
                    
                    const content = file.content || '';
                    const lines = content.split('\n');
                    const counts = new Map();
                    
                    let currentLine = '';
                    let currentCount = 0;
                    
                    lines.forEach(line => {
                        if (line === currentLine) {
                            currentCount++;
                        } else {
                            if (currentLine && currentCount > 0) {
                                counts.set(currentLine, currentCount);
                            }
                            currentLine = line;
                            currentCount = 1;
                        }
                    });
                    
                    if (currentLine && currentCount > 0) {
                        counts.set(currentLine, currentCount);
                    }
                    
                    counts.forEach((count, line) => {
                        if (options.c) {
                            this.addToTerminal(`${count.toString().padStart(7)} ${this.escapeHtml(line)}`);
                        } else if (options.d && count > 1) {
                            this.addToTerminal(this.escapeHtml(line));
                        } else if (options.u && count === 1) {
                            this.addToTerminal(this.escapeHtml(line));
                        } else if (!options.d && !options.u) {
                            this.addToTerminal(this.escapeHtml(line));
                        }
                    });
                });
            };

            terminal.cmd_whoami = function(args) {
                this.addToTerminal(this.currentUser);
            };

            terminal.cmd_id = function(args) {
                this.addToTerminal(`uid=1000(${this.currentUser}) gid=1000(${this.currentUser}) groups=1000(${this.currentUser}),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev)`);
            };

            terminal.cmd_groups = function(args) {
                this.addToTerminal(`${this.currentUser} adm cdrom sudo dip plugdev`);
            };

            terminal.cmd_uptime = function(args) {
                const uptime = Math.floor(Math.random() * 86400); // Random uptime in seconds
                const hours = Math.floor(uptime / 3600);
                const minutes = Math.floor((uptime % 3600) / 60);
                const load1 = (Math.random() * 2).toFixed(2);
                const load5 = (Math.random() * 2).toFixed(2);
                const load15 = (Math.random() * 2).toFixed(2);
                
                this.addToTerminal(`${new Date().toLocaleTimeString()} up ${hours}:${minutes.toString().padStart(2, '0')}, 2 users, load average: ${load1}, ${load5}, ${load15}`);
            };

            terminal.cmd_uname = function(args) {
                const options = this.parseOptions(args, ['a', 's', 'n', 'r', 'v', 'm', 'p', 'i', 'o']);
                
                if (options.a) {
                    this.addToTerminal('Linux terminal-playground 5.15.0-89-generic #99-Ubuntu SMP Mon Oct 30 20:42:41 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux');
                } else if (options.s || Object.keys(options).length === 0) {
                    this.addToTerminal('Linux');
                } else {
                    let output = [];
                    if (options.s) output.push('Linux');
                    if (options.n) output.push('terminal-playground');
                    if (options.r) output.push('5.15.0-89-generic');
                    if (options.v) output.push('#99-Ubuntu SMP Mon Oct 30 20:42:41 UTC 2023');
                    if (options.m) output.push('x86_64');
                    if (options.p) output.push('x86_64');
                    if (options.i) output.push('x86_64');
                    if (options.o) output.push('GNU/Linux');
                    this.addToTerminal(output.join(' '));
                }
            };

            terminal.cmd_date = function(args) {
                const now = new Date();
                if (args.length === 0) {
                    this.addToTerminal(now.toString());
                } else {
                    // Simple format support
                    const format = args[0];
                    if (format.startsWith('+')) {
                        let formatted = format.slice(1);
                        formatted = formatted.replace(/%Y/g, now.getFullYear());
                        formatted = formatted.replace(/%m/g, (now.getMonth() + 1).toString().padStart(2, '0'));
                        formatted = formatted.replace(/%d/g, now.getDate().toString().padStart(2, '0'));
                        formatted = formatted.replace(/%H/g, now.getHours().toString().padStart(2, '0'));
                        formatted = formatted.replace(/%M/g, now.getMinutes().toString().padStart(2, '0'));
                        formatted = formatted.replace(/%S/g, now.getSeconds().toString().padStart(2, '0'));
                        this.addToTerminal(formatted);
                    } else {
                        this.addToTerminal(now.toString());
                    }
                }
            };

            terminal.cmd_cal = function(args) {
                const now = new Date();
                const month = args[0] ? parseInt(args[0]) : now.getMonth() + 1;
                const year = args[1] ? parseInt(args[1]) : now.getFullYear();
                
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                  'July', 'August', 'September', 'October', 'November', 'December'];
                
                this.addToTerminal(`    ${monthNames[month - 1]} ${year}`);
                this.addToTerminal('Su Mo Tu We Th Fr Sa');
                
                const firstDay = new Date(year, month - 1, 1).getDay();
                const daysInMonth = new Date(year, month, 0).getDate();
                
                let week = '';
                for (let i = 0; i < firstDay; i++) {
                    week += '   ';
                }
                
                for (let day = 1; day <= daysInMonth; day++) {
                    week += day.toString().padStart(2) + ' ';
                    if ((firstDay + day) % 7 === 0) {
                        this.addToTerminal(week);
                        week = '';
                    }
                }
                
                if (week) {
                    this.addToTerminal(week);
                }
            };

            terminal.cmd_env = function(args) {
                this.environment.forEach((value, key) => {
                    this.addToTerminal(`${key}=${value}`);
                });
            };

            terminal.cmd_export = function(args) {
                if (args.length === 0) {
                    this.cmd_env(args);
                    return;
                }
                
                args.forEach(arg => {
                    const [key, value] = arg.split('=');
                    if (key && value) {
                        this.environment.set(key, value);
                        this.addToTerminal(`<span class="terminal-success">Exported ${key}=${value}</span>`);
                    } else {
                        this.addToTerminal(`<span class="terminal-error">export: invalid syntax</span>`);
                    }
                });
            };

            terminal.cmd_alias = function(args) {
                if (args.length === 0) {
                    this.aliases.forEach((value, key) => {
                        this.addToTerminal(`alias ${key}='${value}'`);
                    });
                    return;
                }
                
                const aliasStr = args.join(' ');
                const match = aliasStr.match(/^(\w+)=(.+)$/);
                if (match) {
                    const [, name, command] = match;
                    this.aliases.set(name, command.replace(/['"]/g, ''));
                    this.addToTerminal(`<span class="terminal-success">Alias created: ${name}</span>`);
                } else {
                    this.addToTerminal(`<span class="terminal-error">alias: invalid syntax</span>`);
                }
            };

            terminal.cmd_echo = function(args) {
                const text = args.join(' ');
                this.addToTerminal(this.escapeHtml(text));
            };

            terminal.cmd_which = function(args) {
                if (args.length === 0) {
                    this.addToTerminal('<span class="terminal-error">which: missing operand</span>');
                    return;
                }
                
                args.forEach(cmd => {
                    if (this.commands[cmd]) {
                        this.addToTerminal(`/usr/bin/${cmd}`);
                    } else if (this.aliases.has(cmd)) {
                        this.addToTerminal(`alias ${cmd}='${this.aliases.get(cmd)}'`);
                    } else {
                        this.addToTerminal(`<span class="terminal-error">${cmd}: not found</span>`);
                    }
                });
            };

            terminal.cmd_file = function(args) {
                if (args.length === 0) {
                    this.addToTerminal('<span class="terminal-error">file: missing operand</span>');
                    return;
                }
                
                args.forEach(fileName => {
                    const targetPath = this.resolvePath(fileName);
                    const file = this.getItemAtPath(targetPath);
                    
                    if (!file) {
                        this.addToTerminal(`${fileName}: cannot open (No such file or directory)`);
                        return;
                    }
                    
                    if (file.type === 'directory') {
                        this.addToTerminal(`${fileName}: directory`);
                    } else {
                        const ext = fileName.split('.').pop().toLowerCase();
                        let fileType = 'data';
                        
                        switch (ext) {
                            case 'txt': fileType = 'ASCII text'; break;
                            case 'html': fileType = 'HTML document'; break;
                            case 'css': fileType = 'CSS stylesheet'; break;
                            case 'js': fileType = 'JavaScript source'; break;
                            case 'json': fileType = 'JSON data'; break;
                            case 'md': fileType = 'Markdown document'; break;
                            case 'pdf': fileType = 'PDF document'; break;
                            case 'sh': fileType = 'shell script'; break;
                            case 'csv': fileType = 'CSV text'; break;
                            default: fileType = 'data';
                        }
                        
                        this.addToTerminal(`${fileName}: ${fileType}`);
                    }
                });
            };

            // Add simplified implementations for remaining commands
            terminal.cmd_sed = function(args) {
                this.addToTerminal('<span class="terminal-warning">sed: simplified implementation</span>');
                this.addToTerminal('Usage: sed "s/pattern/replacement/" file');
                this.addToTerminal('Full sed functionality would require a complete implementation.');
            };

            terminal.cmd_awk = function(args) {
                this.addToTerminal('<span class="terminal-warning">awk: simplified implementation</span>');
                this.addToTerminal('Usage: awk "{print $1}" file');
                this.addToTerminal('Full awk functionality would require a complete implementation.');
            };

            terminal.cmd_tar = function(args) {
                this.addToTerminal('<span class="terminal-warning">tar: simulated command</span>');
                this.addToTerminal('In a real system, this would create/extract tar archives.');
            };

            terminal.cmd_zip = function(args) {
                this.addToTerminal('<span class="terminal-warning">zip: simulated command</span>');
                this.addToTerminal('In a real system, this would create ZIP archives.');
            };

            terminal.cmd_ping = function(args) {
                const host = args[0] || 'localhost';
                this.addToTerminal(`PING ${host} (127.0.0.1): 56 data bytes`);
                this.addToTerminal(`64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.123 ms`);
                this.addToTerminal(`64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.098 ms`);
                this.addToTerminal('<span class="terminal-warning">Simulated ping - use Ctrl+C to stop</span>');
            };

            terminal.cmd_nano = function(args) {
                this.addToTerminal('<span class="terminal-info">nano: text editor (simulated)</span>');
                this.addToTerminal('In a real terminal, this would open the nano text editor.');
                if (args[0]) {
                    this.addToTerminal(`Would edit file: ${args[0]}`);
                }
            };

            terminal.cmd_vim = function(args) {
                this.addToTerminal('<span class="terminal-info">vim: Vi improved editor (simulated)</span>');
                this.addToTerminal('In a real terminal, this would open the vim editor.');
                if (args[0]) {
                    this.addToTerminal(`Would edit file: ${args[0]}`);
                }
            };

            // Update command registry
            Object.assign(terminal.commands, {
                'head': terminal.cmd_head.bind(terminal),
                'tail': terminal.cmd_tail.bind(terminal),
                'wc': terminal.cmd_wc.bind(terminal),
                'sort': terminal.cmd_sort.bind(terminal),
                'uniq': terminal.cmd_uniq.bind(terminal),
                'whoami': terminal.cmd_whoami.bind(terminal),
                'id': terminal.cmd_id.bind(terminal),
                'groups': terminal.cmd_groups.bind(terminal),
                'uptime': terminal.cmd_uptime.bind(terminal),
                'uname': terminal.cmd_uname.bind(terminal),
                'date': terminal.cmd_date.bind(terminal),
                'cal': terminal.cmd_cal.bind(terminal),
                'env': terminal.cmd_env.bind(terminal),
                'export': terminal.cmd_export.bind(terminal),
                'alias': terminal.cmd_alias.bind(terminal),
                'echo': terminal.cmd_echo.bind(terminal),
                'which': terminal.cmd_which.bind(terminal),
                'file': terminal.cmd_file.bind(terminal),
                'sed': terminal.cmd_sed.bind(terminal),
                'awk': terminal.cmd_awk.bind(terminal),
                'tar': terminal.cmd_tar.bind(terminal),
                'zip': terminal.cmd_zip.bind(terminal),
                'ping': terminal.cmd_ping.bind(terminal),
                'nano': terminal.cmd_nano.bind(terminal),
                'vim': terminal.cmd_vim.bind(terminal)
            });
        }

        // Additional utility functions
        terminal.renderTree = function(dir, prefix) {
            const items = Object.entries(dir.children).sort(([a], [b]) => a.localeCompare(b));
            let stats = { dirs: 0, files: 0 };
            
            items.forEach(([name, item], index) => {
                const isLast = index === items.length - 1;
                const connector = isLast ? ' ' : ' ';
                const nextPrefix = prefix + (isLast ? '    ' : '   ');
                
                if (item.type === 'directory') {
                    stats.dirs++;
                    this.addToTerminal(`<span class="ansi-gray">${prefix}${connector}</span> <span class="ansi-blue ansi-bold">${name}/</span>`);
                    const subStats = this.renderTree(item, nextPrefix);
                    stats.dirs += subStats.dirs;
                    stats.files += subStats.files;
                } else {
                    stats.files++;
                    const size = item.size ? ` <span class="ansi-gray">(${this.humanFileSize(item.size)})</span>` : '';
                    this.addToTerminal(`<span class="ansi-gray">${prefix}${connector}</span> <span class="ansi-white">${name}</span>${size}`);
                }
            });
            
            return stats;
        };

        terminal.octalToPermissions = function(octal, type) {
            const perms = ['---', '--x', '-w-', '-wx', 'r--', 'r-x', 'rw-', 'rwx'];
            const typeChar = type === 'directory' ? 'd' : '-';
            const digits = octal.split('').map(d => parseInt(d));
            return typeChar + perms[digits[0]] + perms[digits[1]] + perms[digits[2]];
        };

        terminal.createDirectoryRecursive = function(path) {
            const parts = path.split('/').filter(part => part.length > 0);
            let currentPath = '/';
            let current = this.fileSystem['/'];
            
            for (const part of parts) {
                currentPath += (currentPath === '/' ? '' : '/') + part;
                
                if (!current.children[part]) {
                    current.children[part] = {
                        type: 'directory',
                        permissions: 'drwxr-xr-x',
                        owner: this.currentUser,
                        group: this.currentUser,
                        size: 4096,
                        modified: new Date(),
                        children: {}
                    };
                }
                
                current = current.children[part];
            }
        };
    </script>
</body>
</html>
